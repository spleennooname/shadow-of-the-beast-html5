import{u as t,C as e,M as s,d as r,f as i,w as n,E as a,P as o,g as h,R as l,B as c,e as u,h as d,i as p,j as f,k as y,l as x,m as g,n as m,v as _,o as b,p as S,q as M,s as P,t as k,x as C,y as v,z as w,A as T,F as G,G as R}from"./pixi-core-Cm8ucNvR.js";import{p as z,E as D}from"./vendor-Cffik5UH.js";import{e as B,i as F,v as q,w as I,x as L,I as H,U,S as V,o as A,f as N}from"./pixi-renderer-DLoYYMz9.js";import{d as O,e as j,B as E}from"./pixi-container--XA1H1gw.js";const W=[{offset:0,color:"white"},{offset:1,color:"black"}],X=class i{constructor(...e){this.uid=t("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let s=function(t){let e=t[0]??{};("number"==typeof e||t[1])&&(r("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??Y.defaultLinearOptions.textureSize});return e}(e);s={..."radial"===s.type?i.defaultRadialOptions:i.defaultLinearOptions,...O(s)},this._textureSize=s.textureSize,this._wrapMode=s.wrapMode,"radial"===s.type?(this.center=s.center,this.outerCenter=s.outerCenter??this.center,this.innerRadius=s.innerRadius,this.outerRadius=s.outerRadius,this.scale=s.scale,this.rotation=s.rotation):(this.start=s.start,this.end=s.end),this.textureSpace=s.textureSpace,this.type=s.type,s.colorStops.forEach(t=>{this.addColorStop(t.offset,t.color)})}addColorStop(t,s){return this.colorStops.push({offset:t,color:e.shared.setValue(s).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,n=r-t,a=i-e;const o=n<0||a<0;if("clamp-to-edge"===this._wrapMode){if(n<0){const e=t;t=r,r=e,n*=-1}if(a<0){const t=e;e=i,i=t,a*=-1}}const h=this.colorStops.length?this.colorStops:W,l=this._textureSize,{canvas:c,context:u}=K(l,1),d=o?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);$(d,h),u.fillStyle=d,u.fillRect(0,0,l,1),this.texture=new B({source:new F({resource:c,addressMode:this._wrapMode})});const p=Math.sqrt(n*n+a*a),f=Math.atan2(a,n),y=new s;y.scale(p/l,1),y.rotate(f),y.translate(t,e),"local"===this.textureSpace&&y.scale(l,l),this.transform=y}buildGradient(){this.texture||this._tick++,"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:W,e=this._textureSize,{canvas:r,context:i}=K(e,e),{x:n,y:a}=this.center,{x:o,y:h}=this.outerCenter,l=this.innerRadius,c=this.outerRadius,u=o-c,d=h-c,p=e/(2*c),f=(n-u)*p,y=(a-d)*p,x=i.createRadialGradient(f,y,l*p,(o-u)*p,(h-d)*p,c*p);$(x,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=x,i.translate(f,y),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-f,-y),i.fillRect(0,0,e,e),this.texture=new B({source:new F({resource:r,addressMode:this._wrapMode})});const g=new s;g.scale(1/p,1/p),g.translate(u,d),"local"===this.textureSpace&&g.scale(e,e),this.transform=g}destroy(){this.texture?.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};X.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},X.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Y=X;function $(t,e){for(let s=0;s<e.length;s++){const r=e[s];t.addColorStop(r.offset,r.color)}}function K(t,e){const s=i.get().createCanvas(t,e),r=s.getContext("2d");return{canvas:s,context:r}}const Q={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Z{constructor(e,r){this.uid=t("fillPattern"),this._tick=0,this.transform=new s,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=Q[r].addressModeU,e.source.style.addressModeV=Q[r].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}const J=new s;class tt{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,s=this.renderable;return s?j(e,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){return this.renderable?.groupTransform||J}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const et={extension:{type:a.ShapeBuilder,name:"circle"},build(t,e){let s,r,i,n,a,o;if("circle"===t.type){const e=t;if(a=o=e.radius,a<=0)return!1;s=e.x,r=e.y,i=n=0}else if("ellipse"===t.type){const e=t;if(a=e.halfWidth,o=e.halfHeight,a<=0||o<=0)return!1;s=e.x,r=e.y,i=n=0}else{const e=t,h=e.width/2,l=e.height/2;s=e.x+h,r=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),i=h-a,n=l-o}if(i<0||n<0)return!1;const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(i?4:0)+(n?4:0);if(0===l)return!1;if(0===h)return e[0]=e[6]=s+i,e[1]=e[3]=r+n,e[2]=e[4]=s-i,e[5]=e[7]=r-n,!0;let c=0,u=4*h+(i?2:0)+2,d=u,p=l,f=i+a,y=n,x=s+f,g=s-f,m=r+y;if(e[c++]=x,e[c++]=m,e[--u]=m,e[--u]=g,n){const t=r-y;e[d++]=g,e[d++]=t,e[--p]=t,e[--p]=x}for(let b=1;b<h;b++){const t=Math.PI/2*(b/h),l=i+Math.cos(t)*a,f=n+Math.sin(t)*o,y=s+l,x=s-l,g=r+f,m=r-f;e[c++]=y,e[c++]=g,e[--u]=g,e[--u]=x,e[d++]=x,e[d++]=m,e[--p]=m,e[--p]=y}f=i,y=n+o,x=s+f,g=s-f,m=r+y;const _=r-y;return e[c++]=x,e[c++]=m,e[--p]=_,e[--p]=x,i&&(e[c++]=g,e[c++]=m,e[--p]=_,e[--p]=g),!0},triangulate(t,e,s,r,i,n){if(0===t.length)return;let a=0,o=0;for(let c=0;c<t.length;c+=2)a+=t[c],o+=t[c+1];a/=t.length/2,o/=t.length/2;let h=r;e[h*s]=a,e[h*s+1]=o;const l=h++;for(let c=0;c<t.length;c+=2)e[h*s]=t[c],e[h*s+1]=t[c+1],c>0&&(i[n++]=h,i[n++]=l,i[n++]=h-1),h++;i[n++]=l+1,i[n++]=l,i[n++]=h-1}},st={...et,extension:{...et.extension,name:"ellipse"}},rt={...et,extension:{...et.extension,name:"roundedRectangle"}},it=1e-4;function nt(t,e,s,r,i,n,a,o){let h,l;a?(h=r,l=-s):(h=-r,l=s);const c=t-s*i+h,u=e-r*i+l,d=t+s*n+h,p=e+r*n+l;return o.push(c,u),o.push(d,p),2}function at(t,e,s,r,i,n,a,o){const h=s-t,l=r-e;let c=Math.atan2(h,l),u=Math.atan2(i-t,n-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),y=Math.sqrt(h*h+l*l),x=1+(15*f*Math.sqrt(y)/Math.PI|0),g=p/x;if(d+=g,o){a.push(t,e),a.push(s,r);for(let s=1,r=d;s<x;s++,r+=g)a.push(t,e),a.push(t+Math.sin(r)*y,e+Math.cos(r)*y);a.push(t,e),a.push(i,n)}else{a.push(s,r),a.push(t,e);for(let s=1,r=d;s<x;s++,r+=g)a.push(t+Math.sin(r)*y,e+Math.cos(r)*y),a.push(t,e);a.push(i,n),a.push(t,e)}return 2*x}function ot(t,e,s,r,i,n,a){const o=h(t,e,2);if(!o)return;for(let h=0;h<o.length;h+=3)n[a++]=o[h]+i,n[a++]=o[h+1]+i,n[a++]=o[h+2]+i;let l=i*r;for(let h=0;h<t.length;h+=2)s[l]=t[h],s[l+1]=t[h+1],l+=r}const ht=[],lt={extension:{type:a.ShapeBuilder,name:"polygon"},build(t,e){for(let s=0;s<t.points.length;s++)e[s]=t.points[s];return!0},triangulate(t,e,s,r,i,n){ot(t,ht,e,s,r,i,n)}},ct={extension:{type:a.ShapeBuilder,name:"rectangle"},build(t,e){const s=t,r=s.x,i=s.y,n=s.width,a=s.height;return n>0&&a>0&&(e[0]=r,e[1]=i,e[2]=r+n,e[3]=i,e[4]=r+n,e[5]=i+a,e[6]=r,e[7]=i+a,!0)},triangulate(t,e,s,r,i,n){let a=0;e[(r*=s)+a]=t[0],e[r+a+1]=t[1],a+=s,e[r+a]=t[2],e[r+a+1]=t[3],a+=s,e[r+a]=t[6],e[r+a+1]=t[7],a+=s,e[r+a]=t[4],e[r+a+1]=t[5],a+=s;const o=r/s;i[n++]=o,i[n++]=o+1,i[n++]=o+2,i[n++]=o+1,i[n++]=o+3,i[n++]=o+2}},ut={extension:{type:a.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,!0),triangulate(t,e,s,r,i,n){let a=0;e[(r*=s)+a]=t[0],e[r+a+1]=t[1],a+=s,e[r+a]=t[2],e[r+a+1]=t[3],a+=s,e[r+a]=t[4],e[r+a+1]=t[5];const o=r/s;i[n++]=o,i[n++]=o+1,i[n++]=o+2}},dt=new s,pt=new l;const ft={};u.handleByMap(a.ShapeBuilder,ft),u.add(ct,lt,ut,et,st,rt);const yt=new l,xt=new s;function gt(t,e,s){const r=[],i=ft.rectangle,n=yt;n.x=t.dx,n.y=t.dy,n.width=t.dw,n.height=t.dh;const a=t.transform;if(!i.build(n,r))return;const{vertices:o,uvs:h,indices:l}=s,u=l.length,d=o.length/2;a&&q(r,a),i.triangulate(r,o,2,d,l,u);const p=t.image,f=p.uvs;h.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const y=c.get(tt);y.indexOffset=u,y.indexSize=l.length-u,y.attributeOffset=d,y.attributeSize=o.length/2-d,y.baseColor=t.style,y.alpha=t.alpha,y.texture=p,y.geometryData=s,e.push(y)}function mt(t,e,s,r,i){const{vertices:n,uvs:a,indices:h}=i;t.shapePrimitives.forEach(({shape:t,transform:l,holes:u})=>{const d=[],p=ft[t.type];if(!p.build(t,d))return;const f=h.length,y=n.length/2;let x="triangle-list";if(l&&q(d,l),s){const s=t.closePath??!0,r=e;r.pixelLine?(!function(t,e,s,r){const i=it;if(0===t.length)return;const n=t[0],a=t[1],o=t[t.length-2],h=t[t.length-1],l=e||Math.abs(n-o)<i&&Math.abs(a-h)<i,c=s,u=t.length/2,d=c.length/2;for(let p=0;p<u;p++)c.push(t[2*p]),c.push(t[2*p+1]);for(let p=0;p<u-1;p++)r.push(d+p,d+p+1);l&&r.push(d+u-1,d)}(d,s,n,h),x="line-list"):function(t,e,s,r,i,n){const a=it;if(0===t.length)return;const h=e;let l=h.alignment;if(.5!==e.alignment){let e=function(t){const e=t.length;if(e<6)return 1;let s=0;for(let r=0,i=t[e-2],n=t[e-1];r<e;r+=2){const e=t[r],a=t[r+1];s+=(e-i)*(a+n),i=e,n=a}return s<0?-1:1}(t);l=(l-.5)*e+.5}const c=new o(t[0],t[1]),u=new o(t[t.length-2],t[t.length-1]),d=r,p=Math.abs(c.x-u.x)<a&&Math.abs(c.y-u.y)<a;if(d){t=t.slice(),p&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const e=.5*(c.x+u.x),s=.5*(u.y+c.y);t.unshift(e,s),t.push(e,s)}const f=i,y=t.length/2;let x=t.length;const g=f.length/2,m=h.width/2,_=m*m,b=h.miterLimit*h.miterLimit;let S=t[0],M=t[1],P=t[2],k=t[3],C=0,v=0,w=-(M-k),T=S-P,G=0,R=0,z=Math.sqrt(w*w+T*T);w/=z,T/=z,w*=m,T*=m;const D=2*(1-l),B=2*l;d||("round"===h.cap?x+=at(S-w*(D-B)*.5,M-T*(D-B)*.5,S-w*D,M-T*D,S+w*B,M+T*B,f,!0)+2:"square"===h.cap&&(x+=nt(S,M,w,T,D,B,!0,f))),f.push(S-w*D,M-T*D),f.push(S+w*B,M+T*B);for(let o=1;o<y-1;++o){S=t[2*(o-1)],M=t[2*(o-1)+1],P=t[2*o],k=t[2*o+1],C=t[2*(o+1)],v=t[2*(o+1)+1],w=-(M-k),T=S-P,z=Math.sqrt(w*w+T*T),w/=z,T/=z,w*=m,T*=m,G=-(k-v),R=P-C,z=Math.sqrt(G*G+R*R),G/=z,R/=z,G*=m,R*=m;const e=P-S,s=M-k,r=P-C,i=v-k,n=e*r+s*i,a=s*r-i*e,l=a<0;if(Math.abs(a)<.001*Math.abs(n)){f.push(P-w*D,k-T*D),f.push(P+w*B,k+T*B),n>=0&&("round"===h.join?x+=at(P,k,P-w*D,k-T*D,P-G*D,k-R*D,f,!1)+4:x+=2,f.push(P-G*B,k-R*B),f.push(P+G*D,k+R*D));continue}const c=(-w+S)*(-T+k)-(-w+P)*(-T+M),u=(-G+C)*(-R+k)-(-G+P)*(-R+v),d=(e*u-r*c)/a,p=(i*c-s*u)/a,y=(d-P)*(d-P)+(p-k)*(p-k),g=P+(d-P)*D,F=k+(p-k)*D,q=P-(d-P)*B,I=k-(p-k)*B,L=l?D:B;y<=Math.min(e*e+s*s,r*r+i*i)+L*L*_?"bevel"===h.join||y/_>b?(l?(f.push(g,F),f.push(P+w*B,k+T*B),f.push(g,F),f.push(P+G*B,k+R*B)):(f.push(P-w*D,k-T*D),f.push(q,I),f.push(P-G*D,k-R*D),f.push(q,I)),x+=2):"round"===h.join?l?(f.push(g,F),f.push(P+w*B,k+T*B),x+=at(P,k,P+w*B,k+T*B,P+G*B,k+R*B,f,!0)+4,f.push(g,F),f.push(P+G*B,k+R*B)):(f.push(P-w*D,k-T*D),f.push(q,I),x+=at(P,k,P-w*D,k-T*D,P-G*D,k-R*D,f,!1)+4,f.push(P-G*D,k-R*D),f.push(q,I)):(f.push(g,F),f.push(q,I)):(f.push(P-w*D,k-T*D),f.push(P+w*B,k+T*B),"round"===h.join?x+=l?at(P,k,P+w*B,k+T*B,P+G*B,k+R*B,f,!0)+2:at(P,k,P-w*D,k-T*D,P-G*D,k-R*D,f,!1)+2:"miter"===h.join&&y/_<=b&&(l?(f.push(q,I),f.push(q,I)):(f.push(g,F),f.push(g,F)),x+=2),f.push(P-G*D,k-R*D),f.push(P+G*B,k+R*B),x+=2)}S=t[2*(y-2)],M=t[2*(y-2)+1],P=t[2*(y-1)],k=t[2*(y-1)+1],w=-(M-k),T=S-P,z=Math.sqrt(w*w+T*T),w/=z,T/=z,w*=m,T*=m,f.push(P-w*D,k-T*D),f.push(P+w*B,k+T*B),d||("round"===h.cap?x+=at(P-w*(D-B)*.5,k-T*(D-B)*.5,P-w*D,k-T*D,P+w*B,k+T*B,f,!1)+2:"square"===h.cap&&(x+=nt(P,k,w,T,D,B,!1,f)));for(let o=g;o<x+g-2;++o)S=f[2*o],M=f[2*o+1],P=f[2*(o+1)],k=f[2*(o+1)+1],C=f[2*(o+2)],v=f[2*(o+2)+1],Math.abs(S*(k-v)+P*(v-M)+C*(M-k))<1e-8||n.push(o,o+1,o+2)}(d,r,0,s,n,h)}else if(u){const t=[],e=d.slice();(function(t){const e=[];for(let s=0;s<t.length;s++){const r=t[s].shape,i=[];ft[r.type].build(r,i)&&e.push(i)}return e})(u).forEach(s=>{t.push(e.length/2),e.push(...s)}),ot(e,t,n,2,y,h,f)}else p.triangulate(d,n,2,y,h,f);const g=a.length/2,m=e.texture;if(m!==B.WHITE){const s=function(t,e,s,r){const i=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){const t=s.getBounds(pt);e.width&&t.pad(e.width);const{x:r,y:n}=t,a=1/t.width,o=1/t.height,h=-r*a,l=-n*o,c=i.a,u=i.b,d=i.c,p=i.d;i.a*=a,i.b*=a,i.c*=o,i.d*=o,i.tx=h*c+l*d+i.tx,i.ty=h*u+l*p+i.ty}else i.translate(e.texture.frame.x,e.texture.frame.y),i.scale(1/e.texture.source.width,1/e.texture.source.height);const n=e.texture.source.style;return e.fill instanceof Y||"clamp-to-edge"!==n.addressMode||(n.addressMode="repeat",n.update()),r&&i.append(dt.copyFrom(r).invert()),i}(xt,e,t,l);I(n,2,y,a,g,2,n.length/2-y,s)}else L(a,g,2,n.length/2-y);const _=c.get(tt);_.indexOffset=f,_.indexSize=h.length-f,_.attributeOffset=y,_.attributeSize=n.length/2-y,_.baseColor=e.color,_.alpha=e.alpha,_.texture=m,_.geometryData=i,_.topology=x,r.push(_)})}class _t{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class bt{constructor(){this.instructions=new H}init(t){this.batcher=new p({maxTextures:t}),this.instructions.reset()}get geometry(){return r(f,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const St=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){t.defaultOptions.bezierSmoothness=e?.bezierSmoothness??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){const{geometryData:s,batches:r}=e;r.length=0,s.indices.length=0,s.vertices.length=0,s.uvs.length=0;for(let i=0;i<t.instructions.length;i++){const e=t.instructions[i];if("texture"===e.action)gt(e.data,r,s);else if("fill"===e.action||"stroke"===e.action){const t="stroke"===e.action,i=e.data.path.shapePath,n=e.data.style,a=e.data.hole;t&&a&&mt(a.shapePath,n,!0,r,s),a&&(i.shapePrimitives[i.shapePrimitives.length-1].holes=a.shapePath.shapePrimitives),mt(i,n,t,r,s)}}}(t,e);const s=t.batchMode;t.customShader||"no-batch"===s?e.isBatchable=!1:e.isBatchable="auto"!==s||e.geometryData.vertices.length<400,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=c.get(bt,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:s,geometryData:r}=this._gpuContextHash[t.uid],i=r.vertices.length,n=r.indices.length;for(let l=0;l<s.length;l++)s[l].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(i),a.ensureIndexBuffer(n),a.begin();for(let l=0;l<s.length;l++){const t=s[l];a.add(t)}a.finish(e.instructions);const o=a.geometry;o.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),o.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const h=a.batches;for(let l=0;l<h.length;l++){const t=h[l];t.bindGroup=d(t.textures.textures,t.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new _t;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(c.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(t=>{c.return(t)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};St.extension={type:[a.WebGLSystem,a.WebGPUSystem,a.CanvasSystem],name:"graphicsContext"},St.defaultOptions={bezierSmoothness:.5};let Mt=St;const Pt=1.1920929e-7;function kt(t,e,s,r,i,n,a,o,h,l){let c=(1-Math.min(.99,Math.max(0,l??Mt.defaultOptions.bezierSmoothness)))/1;return c*=c,function(t,e,s,r,i,n,a,o,h,l){Ct(t,e,s,r,i,n,a,o,h,l,0),h.push(a,o)}(e,s,r,i,n,a,o,h,t,c),t}function Ct(t,e,s,r,i,n,a,o,h,l,c){if(c>8)return;const u=(t+s)/2,d=(e+r)/2,p=(s+i)/2,f=(r+n)/2,y=(i+a)/2,x=(n+o)/2,g=(u+p)/2,m=(d+f)/2,_=(p+y)/2,b=(f+x)/2,S=(g+_)/2,M=(m+b)/2;if(c>0){let c=a-t,u=o-e;const d=Math.abs((s-a)*u-(r-o)*c),p=Math.abs((i-a)*u-(n-o)*c);if(d>Pt&&p>Pt){if((d+p)*(d+p)<=l*(c*c+u*u))return void h.push(S,M)}else if(d>Pt){if(d*d<=l*(c*c+u*u))return void h.push(S,M)}else if(p>Pt){if(p*p<=l*(c*c+u*u))return void h.push(S,M)}else if(c=S-(t+a)/2,u=M-(e+o)/2,c*c+u*u<=l)return void h.push(S,M)}Ct(t,e,u,d,g,m,S,M,h,l,c+1),Ct(S,M,_,b,y,x,a,o,h,l,c+1)}function vt(t,e,s,r,i,n,a,o){let h=(1-Math.min(.99,Math.max(0,o??Mt.defaultOptions.bezierSmoothness)))/1;return h*=h,function(t,e,s,r,i,n,a,o){wt(a,t,e,s,r,i,n,o,0),a.push(i,n)}(e,s,r,i,n,a,t,h),t}function wt(t,e,s,r,i,n,a,o,h){if(h>8)return;const l=(e+r)/2,c=(s+i)/2,u=(r+n)/2,d=(i+a)/2,p=(l+u)/2,f=(c+d)/2;let y=n-e,x=a-s;const g=Math.abs((r-n)*x-(i-a)*y);if(g>1.1920929e-7){if(g*g<=o*(y*y+x*x))return void t.push(p,f)}else if(y=p-(e+n)/2,x=f-(s+a)/2,y*y+x*x<=o)return void t.push(p,f);wt(t,e,s,l,c,p,f,o,h+1),wt(t,p,f,u,d,n,a,o,h+1)}function Tt(t,e,s,r,i,n,a,o){let h=Math.abs(i-n);(!a&&i>n||a&&n>i)&&(h=2*Math.PI-h),o||(o=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(h/Math.PI))));let l=h/(o=Math.max(o,3)),c=i;l*=a?-1:1;for(let u=0;u<o+1;u++){const i=e+Math.cos(c)*r,n=s+Math.sin(c)*r;t.push(i,n),c+=l}}const Gt=2*Math.PI,Rt={centerX:0,centerY:0,ang1:0,ang2:0},zt=({x:t,y:e},s,r,i,n,a,o,h)=>{const l=i*(t*=s)-n*(e*=r),c=n*t+i*e;return h.x=l+a,h.y=c+o,h};function Dt(t,e){const s=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),r=1.5707963267948966===e?.551915024494:s,i=Math.cos(t),n=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:i-n*r,y:n+i*r},{x:a+o*r,y:o-a*r},{x:a,y:o}]}const Bt=(t,e,s,r)=>{let i=t*s+e*r;return i>1&&(i=1),i<-1&&(i=-1),(t*r-e*s<0?-1:1)*Math.acos(i)};function Ft(t,e,s,r,i,n,a,o=0,h=0,l=0){if(0===n||0===a)return;const c=Math.sin(o*Gt/360),u=Math.cos(o*Gt/360),d=u*(e-r)/2+c*(s-i)/2,p=-c*(e-r)/2+u*(s-i)/2;if(0===d&&0===p)return;n=Math.abs(n),a=Math.abs(a);const f=Math.pow(d,2)/Math.pow(n,2)+Math.pow(p,2)/Math.pow(a,2);f>1&&(n*=Math.sqrt(f),a*=Math.sqrt(f)),((t,e,s,r,i,n,a,o,h,l,c,u,d)=>{const p=Math.pow(i,2),f=Math.pow(n,2),y=Math.pow(c,2),x=Math.pow(u,2);let g=p*f-p*x-f*y;g<0&&(g=0),g/=p*x+f*y,g=Math.sqrt(g)*(a===o?-1:1);const m=g*i/n*u,_=g*-n/i*c,b=l*m-h*_+(t+s)/2,S=h*m+l*_+(e+r)/2,M=(c-m)/i,P=(u-_)/n,k=(-c-m)/i,C=(-u-_)/n,v=Bt(1,0,M,P);let w=Bt(M,P,k,C);0===o&&w>0&&(w-=Gt),1===o&&w<0&&(w+=Gt),d.centerX=b,d.centerY=S,d.ang1=v,d.ang2=w})(e,s,r,i,n,a,h,l,c,u,d,p,Rt);let{ang1:y,ang2:x}=Rt;const{centerX:g,centerY:m}=Rt;let _=Math.abs(x)/(Gt/4);Math.abs(1-_)<1e-7&&(_=1);const b=Math.max(Math.ceil(_),1);x/=b;let S=t[t.length-2],M=t[t.length-1];const P={x:0,y:0};for(let k=0;k<b;k++){const e=Dt(y,x),{x:s,y:r}=zt(e[0],n,a,u,c,g,m,P),{x:i,y:o}=zt(e[1],n,a,u,c,g,m,P),{x:h,y:l}=zt(e[2],n,a,u,c,g,m,P);kt(t,S,M,s,r,i,o,h,l),S=h,M=l,y+=x}}const qt=new l;class It{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new E,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const s=this._currentPoly.points,r=s[s.length-2],i=s[s.length-1];return r===t&&i===e||s.push(t,e),this}arc(t,e,s,r,i,n){this._ensurePoly(!1);return Tt(this._currentPoly.points,t,e,s,r,i,n),this}arcTo(t,e,s,r,i){this._ensurePoly();return function(t,e,s,r,i,n){const a=t[t.length-2],o=t[t.length-1]-s,h=a-e,l=i-s,c=r-e,u=Math.abs(o*c-h*l);if(u<1e-8||0===n)return void(t[t.length-2]===e&&t[t.length-1]===s||t.push(e,s));const d=o*o+h*h,p=l*l+c*c,f=o*l+h*c,y=n*Math.sqrt(d)/u,x=n*Math.sqrt(p)/u,g=y*f/d,m=x*f/p,_=y*c+x*h,b=y*l+x*o,S=h*(x+g),M=o*(x+g),P=c*(y+m),k=l*(y+m);Tt(t,_+e,b+s,n,Math.atan2(M-b,S-_),Math.atan2(k-b,P-_),h*l>c*o)}(this._currentPoly.points,t,e,s,r,i),this}arcToSvg(t,e,s,r,i,n,a){return Ft(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,n,a,t,e,s,r,i),this}bezierCurveTo(t,e,s,r,i,n,a){this._ensurePoly();const o=this._currentPoly;return kt(this._currentPoly.points,o.lastX,o.lastY,t,e,s,r,i,n,a),this}quadraticCurveTo(t,e,s,r,i){this._ensurePoly();const n=this._currentPoly;return vt(this._currentPoly.points,n.lastX,n.lastY,t,e,s,r,i),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);const s=this.shapePrimitives,r=s.length;for(let i=0;i<t.instructions.length;i++){const e=t.instructions[i];this[e.action](...e.data)}if(t.checkForHoles&&s.length-r>1){let t=null;for(let e=r;e<s.length;e++){const r=s[e];if("polygon"===r.shape.type){const i=r.shape,n=t?.shape;n&&n.containsPolygon(i)?(t.holes||(t.holes=[]),t.holes.push(r),s.copyWithin(e,e+1),s.length--,e--):t=r}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,s,r,i){return this.drawShape(new l(t,e,s,r),i),this}circle(t,e,s,r){return this.drawShape(new y(t,e,s),r),this}poly(t,e,s){const r=new x(t);return r.closePath=e,this.drawShape(r,s),this}regularPoly(t,e,s,r,i=0,n){r=Math.max(0|r,3);const a=-1*Math.PI/2+i,o=2*Math.PI/r,h=[];for(let l=0;l<r;l++){const r=a-l*o;h.push(t+s*Math.cos(r),e+s*Math.sin(r))}return this.poly(h,!0,n),this}roundPoly(t,e,s,r,i,n=0,a){if(r=Math.max(0|r,3),i<=0)return this.regularPoly(t,e,s,r,n);const o=s*Math.sin(Math.PI/r)-.001;i=Math.min(i,o);const h=-1*Math.PI/2+n,l=2*Math.PI/r,c=(r-2)*Math.PI/r/2;for(let u=0;u<r;u++){const r=u*l+h,n=t+s*Math.cos(r),o=e+s*Math.sin(r),d=r+Math.PI+c,p=r-Math.PI-c,f=n+i*Math.cos(d),y=o+i*Math.sin(d),x=n+i*Math.cos(p),g=o+i*Math.sin(p);0===u?this.moveTo(f,y):this.lineTo(f,y),this.quadraticCurveTo(n,o,x,g,a)}return this.closePath()}roundShape(t,e,s=!1,r){return t.length<3?this:(s?function(t,e,s,r){const i=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),n=(t,e,s)=>({x:t.x+(e.x-t.x)*s,y:t.y+(e.y-t.y)*s}),a=e.length;for(let o=0;o<a;o++){const h=e[(o+1)%a],l=h.radius??s;if(l<=0){0===o?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);continue}const c=e[o],u=e[(o+2)%a],d=i(c,h);let p;p=d<1e-4?h:n(h,c,Math.min(d/2,l)/d);const f=i(u,h);let y;y=f<1e-4?h:n(h,u,Math.min(f/2,l)/f),0===o?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(h.x,h.y,y.x,y.y,r)}}(this,t,e,r):function(t,e,s){const r=(t,e)=>{const s=e.x-t.x,r=e.y-t.y,i=Math.sqrt(s*s+r*r);return{len:i,nx:s/i,ny:r/i}},i=(e,s)=>{0===e?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)};let n=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],h=o.radius??s;if(h<=0){i(a,o),n=o;continue}const l=e[(a+1)%e.length],c=r(o,n),u=r(o,l);if(c.len<1e-4||u.len<1e-4){i(a,o),n=o;continue}let d=Math.asin(c.nx*u.ny-c.ny*u.nx),p=1,f=!1;c.nx*u.nx-c.ny*-u.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,p=-1,f=!0):d>0&&(p=-1,f=!0);const y=d/2;let x,g=Math.abs(Math.cos(y)*h/Math.sin(y));g>Math.min(c.len/2,u.len/2)?(g=Math.min(c.len/2,u.len/2),x=Math.abs(g*Math.sin(y)/Math.cos(y))):x=h;const m=o.x+u.nx*g+-u.ny*x*p,_=o.y+u.ny*g+u.nx*x*p,b=Math.atan2(c.ny,c.nx)+Math.PI/2*p,S=Math.atan2(u.ny,u.nx)-Math.PI/2*p;0===a&&t.moveTo(m+Math.cos(b)*x,_+Math.sin(b)*x),t.arc(m,_,x,b,S,f),n=o}}(this,t,e),this.closePath())}filletRect(t,e,s,r,i){if(0===i)return this.rect(t,e,s,r);const n=Math.min(s,r)/2,a=Math.min(n,Math.max(-n,i)),o=t+s,h=e+r,l=a<0?-a:0,c=Math.abs(a);return this.moveTo(t,e+c).arcTo(t+l,e+l,t+c,e,c).lineTo(o-c,e).arcTo(o-l,e+l,o,e+c,c).lineTo(o,h-c).arcTo(o-l,h-l,t+s-c,h,c).lineTo(t+c,h).arcTo(t+l,h-l,t,h-c,c).closePath()}chamferRect(t,e,s,r,i,n){if(i<=0)return this.rect(t,e,s,r);const a=Math.min(i,Math.min(s,r)/2),o=t+s,h=e+r,l=[t+a,e,o-a,e,o,e+a,o,h-a,o-a,h,t+a,h,t,h-a,t,e+a];for(let c=l.length-1;c>=2;c-=2)l[c]===l[c-2]&&l[c-1]===l[c-3]&&l.splice(c-1,2);return this.poly(l,!0,n)}ellipse(t,e,s,r,i){return this.drawShape(new g(t,e,s,r),i),this}roundRect(t,e,s,r,i,n){return this.drawShape(new m(t,e,s,r,i),n),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let s=this._currentPoly;return s&&this.endPoly(),s=new x,s.points.push(t,e),this._currentPoly=s,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new x,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,s=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const r=t.transform,i=e;e=r.a*e+r.c*s+r.tx,s=r.b*i+r.d*s+r.ty}this._currentPoly.points.push(e,s)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];this[s.action](...s.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let s=0;s<e.length;s++){const r=e[s],i=r.shape.getBounds(qt);r.transform?t.addRect(i,r.transform):t.addRect(i)}return t}}class Lt{constructor(e,s=!1){this.instructions=[],this.uid=t("graphicsPath"),this._dirty=!0,this.checkForHoles=s,"string"==typeof e?function(t,e){const s=z(t),r=[];let i=null,a=0,o=0;for(let h=0;h<s.length;h++){const t=s[h],l=t[0],c=t;switch(l){case"M":a=c[1],o=c[2],e.moveTo(a,o);break;case"m":a+=c[1],o+=c[2],e.moveTo(a,o);break;case"H":a=c[1],e.lineTo(a,o);break;case"h":a+=c[1],e.lineTo(a,o);break;case"V":o=c[1],e.lineTo(a,o);break;case"v":o+=c[1],e.lineTo(a,o);break;case"L":a=c[1],o=c[2],e.lineTo(a,o);break;case"l":a+=c[1],o+=c[2],e.lineTo(a,o);break;case"C":a=c[5],o=c[6],e.bezierCurveTo(c[1],c[2],c[3],c[4],a,o);break;case"c":e.bezierCurveTo(a+c[1],o+c[2],a+c[3],o+c[4],a+c[5],o+c[6]),a+=c[5],o+=c[6];break;case"S":a=c[3],o=c[4],e.bezierCurveToShort(c[1],c[2],a,o);break;case"s":e.bezierCurveToShort(a+c[1],o+c[2],a+c[3],o+c[4]),a+=c[3],o+=c[4];break;case"Q":a=c[3],o=c[4],e.quadraticCurveTo(c[1],c[2],a,o);break;case"q":e.quadraticCurveTo(a+c[1],o+c[2],a+c[3],o+c[4]),a+=c[3],o+=c[4];break;case"T":a=c[1],o=c[2],e.quadraticCurveToShort(a,o);break;case"t":a+=c[1],o+=c[2],e.quadraticCurveToShort(a,o);break;case"A":a=c[6],o=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],a,o);break;case"a":a+=c[6],o+=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],a,o);break;case"Z":case"z":e.closePath(),r.length>0&&(i=r.pop(),i?(a=i.startX,o=i.startY):(a=0,o=0)),i=null;break;default:n(`Unknown SVG path command: ${l}`)}"Z"!==l&&"z"!==l&&null===i&&(i={startX:a,startY:o},r.push(i))}}(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new It(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,s,r,i){const n=this.instructions[this.instructions.length-1],a=this.getLastPoint(o.shared);let h=0,l=0;if(n&&"bezierCurveTo"===n.action){h=n.data[2],l=n.data[3];const t=a.x,e=a.y;h=t+(t-h),l=e+(e-l)}else h=a.x,l=a.y;return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,s,r,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,s){const r=this.instructions[this.instructions.length-1],i=this.getLastPoint(o.shared);let n=0,a=0;if(r&&"quadraticCurveTo"===r.action){n=r.data[0],a=r.data[1];const t=i.x,e=i.y;n=t+(t-n),a=e+(e-a)}else n=i.x,a=i.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,a,t,e,s]}),this._dirty=!0,this}rect(t,e,s,r,i){return this.instructions.push({action:"rect",data:[t,e,s,r,i]}),this._dirty=!0,this}circle(t,e,s,r){return this.instructions.push({action:"circle",data:[t,e,s,r]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,s,r,i,n,a){i||(i=r/2);const o=-1*Math.PI/2+n,h=2*s,l=2*Math.PI/h,c=[];for(let u=0;u<h;u++){const s=u%2?i:r,n=u*l+o;c.push(t+s*Math.cos(n),e+s*Math.sin(n))}return this.poly(c,!0,a),this}clone(t=!1){const e=new Lt;if(e.checkForHoles=this.checkForHoles,t)for(let s=0;s<this.instructions.length;s++){const t=this.instructions[s];e.instructions.push({action:t.action,data:t.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,s=t.b,r=t.c,i=t.d,a=t.tx,o=t.ty;let h=0,l=0,c=0,u=0,d=0,p=0,f=0,y=0;for(let x=0;x<this.instructions.length;x++){const g=this.instructions[x],m=g.data;switch(g.action){case"moveTo":case"lineTo":h=m[0],l=m[1],m[0]=e*h+r*l+a,m[1]=s*h+i*l+o;break;case"bezierCurveTo":c=m[0],u=m[1],d=m[2],p=m[3],h=m[4],l=m[5],m[0]=e*c+r*u+a,m[1]=s*c+i*u+o,m[2]=e*d+r*p+a,m[3]=s*d+i*p+o,m[4]=e*h+r*l+a,m[5]=s*h+i*l+o;break;case"quadraticCurveTo":c=m[0],u=m[1],h=m[2],l=m[3],m[0]=e*c+r*u+a,m[1]=s*c+i*u+o,m[2]=e*h+r*l+a,m[3]=s*h+i*l+o;break;case"arcToSvg":h=m[5],l=m[6],f=m[0],y=m[1],m[0]=e*f+r*y,m[1]=s*f+i*y,m[5]=e*h+r*l+a,m[6]=s*h+i*l+o;break;case"circle":m[4]=Ht(m[3],t);break;case"rect":m[4]=Ht(m[4],t);break;case"ellipse":m[8]=Ht(m[8],t);break;case"roundRect":m[5]=Ht(m[5],t);break;case"addPath":m[0].transform(t);break;case"poly":m[2]=Ht(m[2],t);break;default:n("unknown transform action",g.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,s=this.instructions[e];if(!s)return t.x=0,t.y=0,t;for(;"closePath"===s.action;){if(e--,e<0)return t.x=0,t.y=0,t;s=this.instructions[e]}switch(s.action){case"moveTo":case"lineTo":t.x=s.data[0],t.y=s.data[1];break;case"quadraticCurveTo":t.x=s.data[2],t.y=s.data[3];break;case"bezierCurveTo":t.x=s.data[4],t.y=s.data[5];break;case"arc":case"arcToSvg":t.x=s.data[5],t.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(t)}return t}}function Ht(t,e){return t?t.prepend(e):e.clone()}function Ut(t,e,s){const r=t.getAttribute(e);return r?Number(r):s}function Vt(t){const s=Ut(t,"x1",0),r=Ut(t,"y1",0),i=Ut(t,"x2",1),n=Ut(t,"y2",0),a=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new Y(s,r,i,n,"objectBoundingBox"===a?"local":"global");for(let h=0;h<t.children.length;h++){const s=t.children[h],r=Ut(s,"offset",0),i=e.shared.setValue(s.getAttribute("stop-color")).toNumber();o.addColorStop(r,i)}return o}function At(t){return n("[SVG Parser] Radial gradients are not yet supported"),new Y(0,0,1,0)}function Nt(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const Ot={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function jt(t,e){const s=t.getAttribute("style"),r={},i={},n={strokeStyle:r,fillStyle:i,useFill:!1,useStroke:!1};for(const a in Ot){const s=t.getAttribute(a);s&&Et(e,n,a,s.trim())}if(s){const t=s.split(";");for(let s=0;s<t.length;s++){const r=t[s].trim(),[i,a]=r.split(":");Ot[i]&&Et(e,n,i,a.trim())}}return{strokeStyle:n.useStroke?r:null,fillStyle:n.useFill?i:null,useFill:n.useFill,useStroke:n.useStroke}}function Et(t,s,r,i){switch(r){case"stroke":if("none"!==i){if(i.startsWith("url(")){const e=Nt(i);s.strokeStyle.fill=t.defs[e]}else s.strokeStyle.color=e.shared.setValue(i).toNumber();s.useStroke=!0}break;case"stroke-width":s.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){const e=Nt(i);s.fillStyle.fill=t.defs[e]}else s.fillStyle.color=e.shared.setValue(i).toNumber();s.useFill=!0}break;case"fill-opacity":s.fillStyle.alpha=Number(i);break;case"stroke-opacity":s.strokeStyle.alpha=Number(i);break;case"opacity":s.fillStyle.alpha=Number(i),s.strokeStyle.alpha=Number(i)}}function Wt(t){const e=t.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!e||e.length<4)return 0;const s=e.map(Number),r=[],i=[];for(let h=0;h<s.length;h+=2)h+1<s.length&&(r.push(s[h]),i.push(s[h+1]));if(0===r.length||0===i.length)return 0;const n=Math.min(...r),a=Math.max(...r),o=Math.min(...i);return(a-n)*(Math.max(...i)-o)}function Xt(t,e){const s=new Lt(t,!1);for(const r of s.instructions)e.instructions.push(r)}function Yt(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}const s={context:e,defs:{},path:new Lt};!function(t,e){const s=t.querySelectorAll("defs");for(let r=0;r<s.length;r++){const t=s[r];for(let s=0;s<t.children.length;s++){const r=t.children[s];switch(r.nodeName.toLowerCase()){case"lineargradient":e.defs[r.id]=Vt(r);break;case"radialgradient":e.defs[r.id]=At()}}}}(t,s);const r=t.children,{fillStyle:i,strokeStyle:n}=jt(t,s);for(let a=0;a<r.length;a++){const t=r[a];"defs"!==t.nodeName.toLowerCase()&&$t(t,s,i,n)}return e}function $t(t,e,s,r){const i=t.children,{fillStyle:a,strokeStyle:o}=jt(t,e);a&&s?s={...s,...a}:a&&(s=a),o&&r?r={...r,...o}:o&&(r=o);const h=!s&&!r;let l,c,u,d,p,f,y,x,g,m,_,b,S,M,P,k,C;switch(h&&(s={color:0}),t.nodeName.toLowerCase()){case"path":{M=t.getAttribute("d");const i=t.getAttribute("fill-rule"),n=M.split(/(?=[Mm])/).filter(t=>t.trim().length>0),a="evenodd"===i,o=n.length>1;if(a&&o){const t=n.map(t=>({path:t,area:Wt(t)}));t.sort((t,e)=>e.area-t.area);const i=n.length>3||!function(t){if(t.length<=2)return!0;const e=t.map(t=>t.area).sort((t,e)=>e-t),[s,r]=e,i=e[e.length-1];return!(s/r>3&&r/i<2)}(t);if(i)for(let n=0;n<t.length;n++){const i=t[n],a=0===n;e.context.beginPath();const o=new Lt(void 0,!0);Xt(i.path,o),e.context.path(o),a?(s&&e.context.fill(s),r&&e.context.stroke(r)):e.context.cut()}else for(let n=0;n<t.length;n++){const i=t[n],a=n%2==1;e.context.beginPath();const o=new Lt(void 0,!0);Xt(i.path,o),e.context.path(o),a?e.context.cut():(s&&e.context.fill(s),r&&e.context.stroke(r))}}else{P=new Lt(M,!i||"evenodd"===i),e.context.path(P),s&&e.context.fill(s),r&&e.context.stroke(r)}break}case"circle":y=Ut(t,"cx",0),x=Ut(t,"cy",0),g=Ut(t,"r",0),e.context.ellipse(y,x,g,g),s&&e.context.fill(s),r&&e.context.stroke(r);break;case"rect":l=Ut(t,"x",0),c=Ut(t,"y",0),k=Ut(t,"width",0),C=Ut(t,"height",0),m=Ut(t,"rx",0),_=Ut(t,"ry",0),m||_?e.context.roundRect(l,c,k,C,m||_):e.context.rect(l,c,k,C),s&&e.context.fill(s),r&&e.context.stroke(r);break;case"ellipse":y=Ut(t,"cx",0),x=Ut(t,"cy",0),m=Ut(t,"rx",0),_=Ut(t,"ry",0),e.context.beginPath(),e.context.ellipse(y,x,m,_),s&&e.context.fill(s),r&&e.context.stroke(r);break;case"line":u=Ut(t,"x1",0),d=Ut(t,"y1",0),p=Ut(t,"x2",0),f=Ut(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,d),e.context.lineTo(p,f),r&&e.context.stroke(r);break;case"polygon":S=t.getAttribute("points"),b=S.match(/\d+/g).map(t=>parseInt(t,10)),e.context.poly(b,!0),s&&e.context.fill(s),r&&e.context.stroke(r);break;case"polyline":S=t.getAttribute("points"),b=S.match(/\d+/g).map(t=>parseInt(t,10)),e.context.poly(b,!1),r&&e.context.stroke(r);break;case"g":case"svg":break;default:n(`[SVG parser] <${t.nodeName}> elements unsupported`)}h&&(s=null);for(let n=0;n<i.length;n++)$t(i[n],e,s,r)}function Kt(t){return t instanceof Z}function Qt(t){return t instanceof Y}function Zt(t,e,s){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...s,...t}}function Jt(t,e,s){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...s,...t}}function te(t,s){if(null==t)return null;const r={},i=t;return function(t){return e.isColorLike(t)}(t)?function(t,s,r){const i=e.shared.setValue(s??0);return t.color=i.toNumber(),t.alpha=1===i.alpha?r.alpha:i.alpha,t.texture=B.WHITE,{...r,...t}}(r,t,s):function(t){return t instanceof B}(t)?function(t,e,s){return t.texture=e,{...s,...t}}(r,t,s):Kt(t)?Zt(r,t,s):Qt(t)?Jt(r,t,s):i.fill&&Kt(i.fill)?Zt(i,i.fill,s):i.fill&&Qt(i.fill)?Jt(i,i.fill,s):function(t,s){const r={...s,...t},i=e.shared.setValue(r.color);return r.alpha*=i.alpha,r.color=i.toNumber(),r}(i,s)}function ee(t,e){const{width:s,alignment:r,miterLimit:i,cap:n,join:a,pixelLine:o,...h}=e,l=te(t,h);return l?{width:s,alignment:r,miterLimit:i,cap:n,join:a,pixelLine:o,...l}:null}const se=new o,re=new s,ie=class i extends D{constructor(){super(...arguments),this.uid=t("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new Lt,this._transform=new s,this._fillStyle={...i.defaultFillStyle},this._strokeStyle={...i.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new E,this._boundsDirty=!0}clone(){const t=new i;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=te(t,i.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=ee(t,i.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=te(t,i.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=te(t,i.defaultStrokeStyle),this}texture(t,s,r,i,n,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:n||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:s?e.shared.setValue(s).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Lt,this}fill(t,e){let s;const n=this.instructions[this.instructions.length-1];return s=0===this._tick&&n&&"stroke"===n.action?n.data.path:this._activePath.clone(),s?(null!=t&&(void 0!==e&&"number"==typeof t&&(r(_,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=te(t,i.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(o.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const s=this.instructions[this.instructions.length-1];return e=0===this._tick&&s&&"fill"===s.action?s.data.path:this._activePath.clone(),e?(null!=t&&(this._strokeStyle=ee(t,i.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],s=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=s;break}e.data.hole.addPath(s)}}return this._initNextPathLocation(),this}arc(t,e,s,r,i,n){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,s,r,i,n),this}arcTo(t,e,s,r,i){this._tick++;const n=this._transform;return this._activePath.arcTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*s+n.c*r+n.tx,n.b*s+n.d*r+n.ty,i),this}arcToSvg(t,e,s,r,i,n,a){this._tick++;const o=this._transform;return this._activePath.arcToSvg(t,e,s,r,i,o.a*n+o.c*a+o.tx,o.b*n+o.d*a+o.ty),this}bezierCurveTo(t,e,s,r,i,n,a){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*s+o.c*r+o.tx,o.b*s+o.d*r+o.ty,o.a*i+o.c*n+o.tx,o.b*i+o.d*n+o.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,s,r){return this._tick++,this._activePath.ellipse(t,e,s,r,this._transform.clone()),this}circle(t,e,s){return this._tick++,this._activePath.circle(t,e,s,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty),this}moveTo(t,e){this._tick++;const s=this._transform,r=this._activePath.instructions,i=s.a*t+s.c*e+s.tx,n=s.b*t+s.d*e+s.ty;return 1===r.length&&"moveTo"===r[0].action?(r[0].data[0]=i,r[0].data[1]=n,this):(this._activePath.moveTo(i,n),this)}quadraticCurveTo(t,e,s,r,i){this._tick++;const n=this._transform;return this._activePath.quadraticCurveTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*s+n.c*r+n.tx,n.b*s+n.d*r+n.ty,i),this}rect(t,e,s,r){return this._tick++,this._activePath.rect(t,e,s,r,this._transform.clone()),this}roundRect(t,e,s,r,i){return this._tick++,this._activePath.roundRect(t,e,s,r,i,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,s,r,i=0,n){return this._tick++,this._activePath.regularPoly(t,e,s,r,i,n),this}roundPoly(t,e,s,r,i,n){return this._tick++,this._activePath.roundPoly(t,e,s,r,i,n),this}roundShape(t,e,s,r){return this._tick++,this._activePath.roundShape(t,e,s,r),this}filletRect(t,e,s,r,i){return this._tick++,this._activePath.filletRect(t,e,s,r,i),this}chamferRect(t,e,s,r,i,n){return this._tick++,this._activePath.chamferRect(t,e,s,r,i,n),this}star(t,e,s,r,i=0,n=0){return this._tick++,this._activePath.star(t,e,s,r,i,n,this._transform.clone()),this}svg(t){return this._tick++,Yt(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,n,a){return t instanceof s?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,n,a),this)}transform(t,e,r,i,n,a){return t instanceof s?(this._transform.append(t),this):(re.set(t,e,r,i,n,a),this._transform.append(re),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,this.dirty||(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const s=this.instructions[e],r=s.action;if("fill"===r){const e=s.data;t.addBounds(e.path.bounds)}else if("texture"===r){const e=s.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===r){const e=s.data,r=e.style.alignment,i=e.style.width*(1-r),n=e.path.bounds;t.addFrame(n.minX-i,n.minY-i,n.maxX+i,n.maxY+i)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let s=!1;for(let r=0;r<e.length;r++){const i=e[r],n=i.data,a=n.path;if(!i.action||!a)continue;const o=n.style,h=a.shapePath.shapePrimitives;for(let e=0;e<h.length;e++){const r=h[e].shape;if(!o||!r)continue;const a=h[e].transform,l=a?a.applyInverse(t,se):t;if("fill"===i.action)s=r.contains(l.x,l.y);else{const t=o;s=r.strokeContains(l.x,l.y,t.width,t.alignment)}const c=n.hole;if(c){const t=c.shapePath?.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(l.x,l.y)&&(s=!1)}if(s)return!0}}return s}destroy(t=!1){this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners();if("boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(e)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(e))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};ie.defaultFillStyle={color:16777215,alpha:1,texture:B.WHITE,matrix:null,fill:null,textureSpace:"local"},ie.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:B.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let ne=ie;class ae extends b{constructor(t){t instanceof ne&&(t={context:t});const{context:e,roundPixels:s,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",this._context=e||(this._ownedContext=new ne),this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==t?.context||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){if(t)return new ae(this._context.clone());this._ownedContext=null;return new ae(this._context)}lineStyle(t,e,s){r(_,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),s&&(i.alpha=s),this.context.strokeStyle=i,this}beginFill(t,e){r(_,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return void 0!==t&&(s.color=t),void 0!==e&&(s.alpha=e),this.context.fillStyle=s,this}endFill(){r(_,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===ne.defaultStrokeStyle.width&&t.color===ne.defaultStrokeStyle.color&&t.alpha===ne.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return r(_,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return r(_,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return r(_,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return r(_,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return r(_,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return r(_,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class oe{contextChange(t){const e=new U({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new s,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),r=t.limits.maxBatchableTextures,i=S({name:"graphics",bits:[M,P(r),k,C]});this.shader=new V({glProgram:i,resources:{localUniforms:e,batchSamplers:A(r)}})}execute(t,e){const s=e.context,r=s.customShader||this.shader,i=t.renderer,n=i.graphicsContext,{batcher:a,instructions:o}=n.getContextRenderData(s);r.groups[0]=i.globalUniforms.bindGroup,i.state.set(t.state),i.shader.bind(r),i.geometry.bind(a.geometry,r.glProgram);const h=o.instructions;for(let l=0;l<o.instructionSize;l++){const t=h[l];if(t.size){for(let e=0;e<t.textures.count;e++)i.texture.bind(t.textures.textures[e],e);i.geometry.draw(t.topology,t.size,t.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}function he(t,e,s){const r=(t>>24&255)/255;e[s++]=(255&t)/255*r,e[s++]=(t>>8&255)/255*r,e[s++]=(t>>16&255)/255*r,e[s++]=r}oe.extension={type:[a.WebGLPipesAdaptor],name:"graphics"};class le{constructor(){this._maxTextures=0}contextChange(t){const e=new U({uTransformMatrix:{value:new s,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this._maxTextures=t.limits.maxBatchableTextures;const r=v({name:"graphics",bits:[w,T(this._maxTextures),G,R]});this.shader=new V({gpuProgram:r,resources:{localUniforms:e}})}execute(t,e){const s=e.context,r=s.customShader||this.shader,i=t.renderer,n=i.graphicsContext,{batcher:a,instructions:o}=n.getContextRenderData(s),h=i.encoder;h.setGeometry(a.geometry,r.gpuProgram);const l=i.globalUniforms.bindGroup;h.setBindGroup(0,l,r.gpuProgram);const c=i.renderPipes.uniformBatch.getUniformBindGroup(r.resources.localUniforms,!0);h.setBindGroup(2,c,r.gpuProgram);const u=o.instructions;let p=null;for(let f=0;f<o.instructionSize;f++){const e=u[f];if(e.topology!==p&&(p=e.topology,h.setPipelineFromGeometryProgramAndState(a.geometry,r.gpuProgram,t.state,e.topology)),r.groups[1]=e.bindGroup,!e.gpuBindGroup){const t=e.textures;e.bindGroup=d(t.textures,t.count,this._maxTextures),e.gpuBindGroup=i.bindGroup.getBindGroup(e.bindGroup,r.gpuProgram,1)}h.setBindGroup(1,e.bindGroup,r.gpuProgram),h.renderPassEncoder.drawIndexed(e.size,1,e.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}le.extension={type:[a.WebGPUPipesAdaptor],name:"graphics"};class ce{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{c.return(t)}),this.batches.length=0}}class ue{constructor(t,e){this.state=N.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,s=!!t._gpuData,r=this.renderer.graphicsContext.updateGpuContext(e);return!(!r.isBatchable&&s===r.isBatchable)}addRenderable(t,e){const s=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),s.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._getGpuDataForRenderable(t).batches;for(let s=0;s<e.length;s++){const t=e[s];t._batcher.updateElement(t)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,s=t.context;if(!e.graphicsContext.getGpuContext(s).batches.length)return;const r=s.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const i=r.resources.localUniforms.uniforms;i.uTransformMatrix=t.groupTransform,i.uRound=e._roundPixels|t._roundPixels,he(t.groupColorAlpha,i.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),s=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),s.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const s=this.renderer.renderPipes.batch,r=this._getGpuDataForRenderable(t).batches;for(let i=0;i<r.length;i++){const t=r[i];s.addToBatch(t,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new ce;return t._gpuData[this.renderer.uid]=e,e}_updateBatchesForRenderable(t,e){const s=t.context,r=this.renderer.graphicsContext.getGpuContext(s),i=this.renderer._roundPixels|t._roundPixels;e.batches=r.batches.map(e=>{const s=c.get(tt);return e.copyTo(s),s.renderable=t,s.roundPixels=i,s})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}ue.extension={type:[a.WebGLPipes,a.WebGPUPipes,a.CanvasPipes],name:"graphics"},u.add(ue),u.add(Mt);export{Y as F,ne as G,ee as a,Z as b,he as c,ae as d,oe as e,le as f,te as t};
//# sourceMappingURL=pixi-graphics-q8yFmetg.js.map
