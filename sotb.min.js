var game={audio:null,audioQueue:[],assetQueue:[],config:{},debug:null,delta:0,device:{},devicemotion:null,height:0,input:null,json:{},keyboard:null,modules:{},paths:{},plugins:{},pool:null,scale:1,scene:null,storage:null,system:null,version:"2.0.0",width:0,_booted:!1,_coreModules:["engine.analytics","engine.audio","engine.camera","engine.debug","engine.geometry","engine.input","engine.loader","engine.particle","engine.physics","engine.pool","engine.renderer.core","engine.scene","engine.storage","engine.system","engine.timer","engine.tween"],_current:null,_currentModule:null,_DOMLoaded:!1,_fnTest:/xyz/.test(function(){var a;return a})?/\bsuper\b/:/[\D|\d]*/,_gameLoopId:1,_gameLoops:{},_gameModuleDefined:!1,_initializing:!1,_loader:null,_loadFinished:!1,_moduleQueue:[],_nocache:"",_waitForLoad:0,addAsset:function(a,b){this._addFileToQueue(a,b,"assetQueue")},addAttributes:function(a,b){if(!this[a])throw"Class "+a+" not found";for(var c in b)this[a][c]=b[c]},addAudio:function(a,b){this._addFileToQueue(a,b,"audioQueue")},body:function(a){return this._current.body=a,this._booted||0===this._current.name.indexOf("engine.")?(this._current=null,this._loadFinished&&this._loadModules(),void(this._gameModuleDefined&&this._DOMLoaded&&!this._loadFinished&&this._loadModules())):(this._current=null,this._boot())},clearCache:function(){this.Texture.clearCache(),this.BaseTexture.clearCache(),this.Font.clearCache(),this.json={},this.paths={}},copy:function(a){var b,c,d;if(!a||"object"!=typeof a||a instanceof HTMLElement||a instanceof this.Class||this.Container&&a instanceof this.Container)return a;if(a instanceof Array){for(c=[],d=0,b=a.length;b>d;d++)c[d]=this.copy(a[d]);return c}c={};for(d in a)c[d]=this.copy(a[d]);return c},createClass:function(a,b,c){if("object"==typeof a)return this.Class.extend(a);if(this[a])throw"Class "+a+" already created";if("object"==typeof b&&(c=b,b="Class"),!this[b])throw"Class "+b+" not found";return this[a]=this[b].extend(c),this[a].prototype.name=a,this._currentModule.classes.push(a),this[a]},createScene:function(a,b){return this.createClass(a,"Scene",b)},defineProperties:function(a,b){if(!this[a])throw"Class "+a+" not found";for(var c in b)Object.defineProperty(this[a].prototype,c,{get:b[c].get,set:b[c].set})},getJSON:function(a){return this.json[this.paths[a]]},ksort:function(a,b){if(!a||"object"!=typeof a)return!1;var c,d=[],e={};for(c in a)d.push(c);for(d.sort(b),c=0;c<d.length;c++)e[d[c]]=a[d[c]];return e},merge:function(a,b){for(var c in b){var d=b[c];"object"!=typeof d||d instanceof HTMLElement||d instanceof this.Class||d instanceof this.Container?a[c]=d:(a[c]&&"object"==typeof a[c]||(a[c]=d instanceof Array?[]:{}),this.merge(a[c],d))}return a},module:function(a){if(this._current)throw"Module "+this._current.name+" has no body";if(this.modules[a]&&this.modules[a].body)throw"Module "+a+" is already defined";if(this._current={name:a,requires:[],loaded:!1,classes:[]},0===a.indexOf("game.")&&(this._gameModuleDefined=!0,this._current.requires.push("engine.core")),this.modules[a]=this._current,this._moduleQueue.push(this._current),"engine.core"===a){if(this.config.ignoreModules)for(var b=this._coreModules.length-1;b>=0;b--)-1!==this.config.ignoreModules.indexOf(this._coreModules[b])&&this._coreModules.splice(b,1);this._current.requires=this._coreModules,this.body(function(){})}return this},onStart:function(){},ready:function(){},require:function(a){var b,a=Array.prototype.slice.call(arguments);for(b=0;b<a.length;b++){var c=a[b];c&&-1===this._current.requires.indexOf(c)&&this._current.requires.push(c)}return this},_addFileToQueue:function(a,b,c){if(!(b&&this.paths[b]||this.paths[a])){var d=this._getFilePath(a)+this._nocache;return b&&(this.paths[b]=d),this.paths[a]=d,-1===this[c].indexOf(d)&&this[c].push(d),b}},_boot:function(){this._booted=!0,this._loadNativeExtensions(),this._loadDeviceInformation(),this._normalizeVendorAttribute(window,"requestAnimationFrame"),this._normalizeVendorAttribute(navigator,"vibrate");for(var a in this.device)if(this.device[a]&&this.config[a])for(var b in this.config[a])"object"==typeof this.config[a][b]?this.merge(this.config[b],this.config[a][b]):this.config[b]=this.config[a][b];if((document.location.href.match(/\?nocache/)||this.config.disableCache)&&(this._nocache="?"+Date.now()),"undefined"==typeof this.config.sourceFolder&&(this.config.sourceFolder="src"),"undefined"==typeof this.config.mediaFolder&&(this.config.mediaFolder="media"),this.device.mobile){var c=document.getElementsByTagName("meta");for(a=0;a<c.length;a++)if("viewport"===c[a].name){var d=!0;break}if(!d){var e=document.createElement("meta");e.name="viewport";var f="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no";this.device.iOS71&&(f+=",minimal-ui"),e.content=f,document.getElementsByTagName("head")[0].appendChild(e)}}this.module("engine.core"),"complete"===document.readyState?this._DOMReady():(document.addEventListener("DOMContentLoaded",this._DOMReady.bind(this)),window.addEventListener("load",this._DOMReady.bind(this)))},_clearGameLoop:function(a){this._gameLoops[a]?delete this._gameLoops[a]:window.clearInterval(a)},_DOMReady:function(){if(!this._DOMLoaded){if(!document.body)return setTimeout(this._DOMReady.bind(this),13);this._DOMLoaded=!0,this._gameModuleDefined&&this._loadModules()}},_getFilePath:function(a){return-1!==a.indexOf("://")?a:(this.config.mediaFolder&&(a=this.config.mediaFolder+"/"+a),a)},_getVendorAttribute:function(a,b){var c=b.ucfirst();return a[b]||a["ms"+c]||a["moz"+c]||a["webkit"+c]||a["o"+c]},_loadDeviceInformation:function(){this.device.pixelRatio=window.devicePixelRatio||1,this.device.screen={width:window.screen.availWidth*this.device.pixelRatio,height:window.screen.availHeight*this.device.pixelRatio},this.device.iPod=/iPod/i.test(navigator.userAgent),this.device.iPhone=/iPhone/i.test(navigator.userAgent),this.device.iPhone4=this.device.iPhone&&2===this.device.pixelRatio&&920===this.device.screen.height,this.device.iPhone5=this.device.iPhone&&2===this.device.pixelRatio&&1096===this.device.screen.height,this.device.iPad=/iPad/i.test(navigator.userAgent),this.device.iPadRetina=this.device.iPad&&2===this.device.pixelRatio,this.device.iOS=this.device.iPod||this.device.iPhone||this.device.iPad,this.device.iOS5=this.device.iOS&&/OS 5/i.test(navigator.userAgent),this.device.iOS6=this.device.iOS&&/OS 6/i.test(navigator.userAgent),this.device.iOS7=this.device.iOS&&/OS 7/i.test(navigator.userAgent),this.device.iOS71=this.device.iOS&&/OS 7_1/i.test(navigator.userAgent),this.device.iOS8=this.device.iOS&&/OS 8/i.test(navigator.userAgent),this.device.iOS9=this.device.iOS&&/OS 9/i.test(navigator.userAgent),this.device.android=/android/i.test(navigator.userAgent),this.device.android2=/android 2/i.test(navigator.userAgent);var a=navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);if(this.device.androidStock=!!(a&&a[1]<537),this.device.ie9=/MSIE 9/i.test(navigator.userAgent),this.device.ie10=/MSIE 10/i.test(navigator.userAgent),this.device.ie11=/rv:11.0/i.test(navigator.userAgent),this.device.ie=this.device.ie10||this.device.ie11||this.device.ie9,this.device.wp7=/Windows Phone OS 7/i.test(navigator.userAgent),this.device.wp8=/Windows Phone 8/i.test(navigator.userAgent),this.device.wp=this.device.wp7||this.device.wp8,this.device.wt=this.device.ie&&/Tablet/i.test(navigator.userAgent),this.device.opera=/Opera/i.test(navigator.userAgent)||/OPR/i.test(navigator.userAgent),this.device.crosswalk=/Crosswalk/i.test(navigator.userAgent),this.device.cocoonJS=!!navigator.isCocoonJS,this.device.cocoonCanvasPlus=/CocoonJS/i.test(navigator.browser),this.device.ejecta=/Ejecta/i.test(navigator.userAgent),this.device.facebook=/FB/i.test(navigator.userAgent),this.device.wiiu=/Nintendo WiiU/i.test(navigator.userAgent),this.device.mobile=this.device.iOS||this.device.android||this.device.wp||this.device.wt,"undefined"==typeof navigator.plugins||0===navigator.plugins.length)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),this.device.flash=!0}catch(b){this.device.flash=!1}else this.device.flash=!!navigator.plugins["Shockwave Flash"]},_loadModules:function(){var a,b,c,d,e,f;for(b=0;b<this._moduleQueue.length;b++){for(d=this._moduleQueue[b],f=!0,c=0;c<d.requires.length;c++)e=d.requires[c],this.modules[e]?this.modules[e].loaded||(f=!1):(f=!1,this._loadScript(e,d.name));f&&d.body&&(this._moduleQueue.splice(b,1),d.loaded=!0,this._currentModule=d,d.body(),a=!0,b--,0===this._moduleQueue.length&&this._modulesLoaded())}if(a&&this._moduleQueue.length>0)this._loadModules();else{if(0===this._waitForLoad&&0!==this._moduleQueue.length){var g=[];for(b=0;b<this._moduleQueue.length;b++){var h=[],i=this._moduleQueue[b].requires;for(c=0;c<i.length;c++)d=this.modules[i[c]],d&&d.loaded||h.push(i[c]);g.push(this._moduleQueue[b].name+" (requires: "+h.join(", ")+")")}throw"Unresolved modules:\n"+g.join("\n")}this._loadFinished=!0}},_loadNativeExtensions:function(){Math.distance=function(a,b,c,d){return a=c-a,b=d-b,Math.sqrt(a*a+b*b)},Math._random=Math.random,Math.random=function(a,b){return"number"==typeof b?Math._random()*(b-a)+a:Math._random(a)},Number.prototype.limit=function(a,b){var c=this;return a>c&&(c=a),c>b&&(c=b),c},Number.prototype.round=function(a){return a=a?Math.pow(10,a):1,Math.round(this*a)/a},Number.prototype.random=function(){return Math.random()*this},Array.prototype.erase=function(a){for(var b=this.length;b>=0;b--)if(this[b]===a)return this.splice(b,1),this;return this},Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.shuffle=function(){for(var a=this.length,b=a;b--;){var c=parseInt(Math.random()*a),d=this[b];this[b]=this[c],this[c]=d}return this},Array.prototype.last=function(){return this[this.length-1]},Function.prototype.bind=function(a){var b=this,c=[];return Array.prototype.push.apply(c,arguments),c.shift(),function(){var d=[];return Array.prototype.push.apply(d,c),Array.prototype.push.apply(d,arguments),b.apply(a,d)}},String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)}},_loadScript:function(a,b){this.modules[a]=!0,this._waitForLoad++;var c=a.replace(/\./g,"/")+".js"+this._nocache;this.config.sourceFolder&&(c=this.config.sourceFolder+"/"+c);var d=document.createElement("script");d.type="text/javascript",d.src=c,d.onload=this._scriptLoaded.bind(this),d.onerror=function(){throw"Error loading module "+a+" at "+c+" required from "+b},document.getElementsByTagName("head")[0].appendChild(d)},_modulesLoaded:function(){for(var a in this.config){var b=a.ucfirst();if(this[b])for(var c in this.config[a])this[b][c]=this.config[a][c]}this.config.autoStart===!1||this.system?this.ready():this._start()},_normalizeVendorAttribute:function(a,b){if(!a[b]){var c=this._getVendorAttribute(a,b);a[b]=a[b]||c}},_scriptLoaded:function(){this._waitForLoad--,this._loadModules()},_setGameLoop:function(a){if(this.System.frameRate)return window.setInterval(a,1e3/this.System.frameRate);if(window.requestAnimationFrame){var b=this._gameLoopId++;this._gameLoops[b]=!0;var c=function(){game._gameLoops[b]&&(window.requestAnimationFrame(c),a())};return window.requestAnimationFrame(c),b}return window.setInterval(a,1e3/60)},_setVendorAttribute:function(a,b,c){var d=b.ucfirst();a[b]=a["ms"+d]=a["moz"+d]=a["webkit"+d]=a["o"+d]=c},_start:function(){if(!(this._moduleQueue.length>0)){this.system=new this.System,this.input=new this.Input(this.renderer.canvas),this.Keyboard&&(this.keyboard=new this.Keyboard),this.Audio&&(this.audio=new this.Audio),this.Pool&&(this.pool=new this.Pool),this.Debug&&this.Debug.enabled&&(this.debug=new this.Debug),this.Storage&&this.Storage.id&&(this.storage=new this.Storage),this.Analytics&&this.Analytics.id&&(this.analytics=new this.Analytics);for(var a in this.plugins)this.plugins[a]=new this.plugins[a];this._loader=new game.Loader(this.System.startScene),this.system._rotateScreenVisible||this._loader.start(),this.onStart()}}};game.Core=game,game.Class=function(){},game.Class.extend=function(a){function b(){if(game._initializing)return this;for(var a in this)"object"==typeof this[a]&&(this[a]=game.copy(this[a]));var b=!1;return this.staticInit&&(b=this.staticInit.apply(this,arguments)),this.init&&!b&&this.init.apply(this,arguments),game.scene&&"function"==typeof this.update&&this!==game.scene&&game.scene.addObject(this),this}var c=this.prototype;game._initializing=!0;var d=new this;game._initializing=!1;var e=function(a,b){return function(){var d=this["super"];this["super"]=c[a];var e=b.apply(this,arguments);return this["super"]=d,e}};for(var f in a)"function"==typeof a[f]&&"function"==typeof c[f]&&game._fnTest.test(a[f])?d[f]=e(f,a[f]):d[f]=a[f];return b.prototype=d,b.prototype.constructor=b,b.extend=game.Class.extend,b.inject=function(a){var b=this.prototype,c={},d=function(a,b){return function(){var d=this["super"];this["super"]=c[a];var e=b.apply(this,arguments);return this["super"]=d,e}};for(var e in a)"function"==typeof a[e]&&"function"==typeof b[e]&&game._fnTest.test(a[e])?(c[e]=b[e],b[e]=d(e,a[e])):b[e]=a[e]},b},"undefined"!=typeof exports&&(exports=module.exports=game),game.config={system:{width:640,height:400,center:!0,scale:!0,hires:0},debug:{enabled:!1},scene:{backgroundColor:"#F77384"}},game.module("game.main").body(function(){var a="https://dl.dropboxusercontent.com/u/1358781/lab/games/shadow-of-the-beast/media/",b=a+"sprites/640x400/";game.addAsset(b+"aarbonRun.png","aarbon"),game.addAsset(b+"sky.png","sky"),game.addAsset(b+"luna.png","moon"),game.addAsset(b+"barriere.png","barriere"),game.addAsset(b+"herbe0.png","erba0"),game.addAsset(b+"herbe1.png","erba1"),game.addAsset(b+"herbe2.png","erba2"),game.addAsset(b+"herbe3.png","erba3"),game.addAsset(b+"herbe4.png","erba4"),game.addAsset(b+"nuages0.png","nuv0"),game.addAsset(b+"nuages1.png","nuv1"),game.addAsset(b+"nuages2.png","nuv2"),game.addAsset(b+"nuages3.png","nuv3"),game.addAsset(b+"nuages4.png","nuv4"),game.addAsset(b+"montagnes.png","montagne"),game.addAudio(a+"audio/sotb.mp3","ost"),game.createScene("Main",{backgroundColor:"#F77384",init:function(){this.sky=new game.TilingSprite("sky",game.width,game.height),this.sky.tilePosition.x=0,this.sky.addTo(this.stage),this.moon=new game.Sprite("moon"),this.moon.position.set(500,10),this.moon.blendMode="lighten",this.moon.addTo(this.stage),this.erba4=new game.TilingSprite("erba4"),this.erba4.position.set(0,378),this.erba4.addTo(this.stage),this.erba3=new game.TilingSprite("erba3"),this.erba3.position.set(0,364),this.erba3.addTo(this.stage),this.erba2=new game.TilingSprite("erba2"),this.erba2.position.set(0,350),this.erba2.addTo(this.stage),this.erba1=new game.TilingSprite("erba1"),this.erba1.position.set(0,344),this.erba1.addTo(this.stage),this.erba0=new game.TilingSprite("erba0"),this.erba0.position.set(0,340),this.erba0.addTo(this.stage),this.barr=new game.TilingSprite("barriere"),this.barr.position.set(0,358),this.barr.addTo(this.stage),this.montagne=new game.TilingSprite("montagne"),this.montagne.position.set(0,194),this.montagne.addTo(this.stage),this.nuv0=new game.TilingSprite("nuv0"),this.nuv0.blendMode="lighten",this.nuv0.position.set(0,0),this.nuv0.addTo(this.stage),this.nuv1=new game.TilingSprite("nuv1"),this.nuv1.position.set(0,42),this.nuv1.addTo(this.stage),this.nuv2=new game.TilingSprite("nuv2"),this.nuv2.position.set(0,102),this.nuv2.addTo(this.stage),this.nuv3=new game.TilingSprite("nuv3"),this.nuv3.position.set(0,140),this.nuv3.addTo(this.stage),this.nuv4=new game.TilingSprite("nuv4"),this.nuv4.position.set(0,150),this.nuv4.addTo(this.stage),this.aarbon=new game.SpriteSheet("aarbon",78,100).anim(6,0),this.aarbon.position.set(game.width/2-50,250),this.aarbon.addAnim("run",[0,1,2,3,4,5],{loop:!0,speed:12}),this.aarbon.addTo(this.stage),this.aarbon.play("run"),game.audio.playSound("ost")},update:function(){var a=150;"undefined"!=typeof this.montagne&&(this.montagne.tilePosition.x-=a*game.delta);for(var b=4;b>=0;b--)"undefined"!=typeof this["erba"+b]&&(this["erba"+b].tilePosition.x-=(40*b+a)*game.delta);"undefined"!=typeof this.barr&&(this.barr.tilePosition.x-=a*game.delta);for(var b=0,c=4;4>=b;b++)"undefined"!=typeof this["nuv"+b]&&(this["nuv"+b].tilePosition.x-=(a+40*c--)*game.delta)}})});