import{w as e,Q as t,ab as a,E as o,al as n,am as r,f as s,an as i,ao as d,L as u,ap as l}from"./pixi-core-Cm8ucNvR.js";import{e as c,i as m,V as p}from"./pixi-renderer-DLoYYMz9.js";import{G as g}from"./pixi-graphics-q8yFmetg.js";function h(a,o,n){a.label=n,a._sourceOrigin=n;const r=new c({source:a,label:n}),s=()=>{delete o.promiseCache[n],t.has(n)&&t.remove(n)};return r.source.once("destroy",()=>{o.promiseCache[n]&&(e("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),s())}),r.once("destroy",()=>{a.destroyed||(e("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}const f={extension:{type:o.LoadParser,priority:a.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test:e=>n(e,"image/svg+xml")||r(e,".svg"),async load(e,t,a){return t.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?async function(e){const t=await s.get().fetch(e),a=await t.text(),o=new g;return o.svg(a),o}(e):async function(e,t,a,o){const n=await s.get().fetch(e),r=s.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,r.crossOrigin=o,await r.decode();const d=t.data?.width??r.width,u=t.data?.height??r.height,l=t.data?.resolution||i(e),c=Math.ceil(d*l),p=Math.ceil(u*l),g=s.get().createCanvas(c,p),f=g.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(r,0,0,d*l,u*l);const{parseAsGraphicsContext:x,...v}=t.data??{};return h(new m({resource:g,alphaMode:"premultiply-alpha-on-upload",resolution:l,...v}),a,e)}(e,t,a,this.config.crossOrigin)},unload(e){e.destroy(!0)}};const x=[".jpeg",".jpg",".png",".webp",".avif"],v=["image/jpeg","image/png","image/webp","image/avif"];const y={name:"loadTextures",id:"texture",extension:{type:o.LoadParser,priority:a.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>n(e,v)||r(e,x),async load(e,t,a){let o=null;o=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await d.isImageBitmapSupported()?await d.loadImageBitmap(e,t):await async function(e,t){const a=await s.get().fetch(e);if(!a.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.blob();return"premultiplied-alpha"===t?.data?.alphaMode?createImageBitmap(o,{premultiplyAlpha:"none"}):createImageBitmap(o)}(e,t):await new Promise((t,a)=>{o=s.get().createImage(),o.crossOrigin=this.config.crossOrigin,o.src=e,o.complete?t(o):(o.onload=()=>{t(o)},o.onerror=a)});return h(new m({resource:o,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||i(e),...t.data}),a,e)},unload(e){e.destroy(!0)}},w=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let b,T;function E(e,t,a){void 0!==a||t.startsWith("data:")?!1!==a&&(e.crossOrigin="string"==typeof a?a:"anonymous"):e.crossOrigin=function(e,t=globalThis.location){if(e.startsWith("data:"))return"";t||(t=globalThis.location);const a=new URL(e,document.baseURI);if(a.hostname!==t.hostname||a.port!==t.port||a.protocol!==t.protocol)return"anonymous";return""}(t)}const M={name:"loadVideo",id:"video",extension:{type:o.LoadParser,name:"loadVideo"},test(e){if(!b||!T){const{validVideoExtensions:e,validVideoMime:t}=function(){const e=[],t=[];for(const a of w){const o=p.MIME_TYPES[a.substring(1)]||`video/${a.substring(1)}`;l(o)&&(e.push(a),t.includes(o)||t.push(o))}return{validVideoExtensions:e,validVideoMime:t}}();b=e,T=t}const t=n(e,T),a=r(e,b);return t||a},async load(e,t,a){const o={...p.defaultOptions,resolution:t.data?.resolution||i(e),alphaMode:t.data?.alphaMode||await u(),...t.data},n=document.createElement("video"),r={preload:!1!==o.autoLoad?"auto":void 0,"webkit-playsinline":!1!==o.playsinline?"":void 0,playsinline:!1!==o.playsinline?"":void 0,muted:!0===o.muted?"":void 0,loop:!0===o.loop?"":void 0,autoplay:!1!==o.autoPlay?"":void 0};Object.keys(r).forEach(e=>{const t=r[e];void 0!==t&&n.setAttribute(e,t)}),!0===o.muted&&(n.muted=!0),E(n,e,o.crossorigin);const s=document.createElement("source");let d;if(o.mime)d=o.mime;else if(e.startsWith("data:"))d=e.slice(5,e.indexOf(";"));else if(!e.startsWith("blob:")){const t=e.split("?")[0].slice(e.lastIndexOf(".")+1).toLowerCase();d=p.MIME_TYPES[t]||`video/${t}`}return s.src=e,d&&(s.type=d),new Promise(r=>{const i=async()=>{const s=new p({...o,resource:n});var d;n.removeEventListener("canplay",i),t.data.preload&&await(d=n,new Promise((e,t)=>{function a(){n(),e()}function o(e){n(),t(e)}function n(){d.removeEventListener("canplaythrough",a),d.removeEventListener("error",o)}d.addEventListener("canplaythrough",a),d.addEventListener("error",o),d.load()})),r(h(s,a,e))};o.preload&&!o.autoPlay&&n.load(),n.addEventListener("canplay",i),n.appendChild(s)})},unload(e){e.destroy(!0)}},I={name:"texture-bit",vertex:{header:"\n\n        struct TextureUniforms {\n            uTextureMatrix:mat3x3<f32>,\n        }\n\n        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;\n        ",main:"\n            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n            @group(2) @binding(0) var uTexture: texture_2d<f32>;\n            @group(2) @binding(1) var uSampler: sampler;\n\n\n        ",main:"\n            outColor = textureSample(uTexture, uSampler, vUV);\n        "}},C={name:"texture-bit",vertex:{header:"\n            uniform mat3 uTextureMatrix;\n        ",main:"\n            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;\n        "},fragment:{header:"\n        uniform sampler2D uTexture;\n\n\n        ",main:"\n            outColor = texture(uTexture, vUV);\n        "}};export{f as a,M as b,I as c,y as l,C as t};
//# sourceMappingURL=pixi-textures-Cq7m2Rp-.js.map
