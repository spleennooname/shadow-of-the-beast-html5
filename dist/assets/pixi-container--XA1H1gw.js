import{M as e,R as t,d as r,v as i,r as n,a as s,B as o,P as a,u as h,O as d,e as l,b as u,D as c,w as p,C as f,c as m,E as x,V as g}from"./pixi-core-Cm8ucNvR.js";import{B as _}from"./pixi-sprites-NGNZT2X3.js";import{I as C,T as b,a as y,g as T,G as v,B as R,b as G,S as w,c as Y,d as B,e as A,f as X,U as P,h as S}from"./pixi-renderer-DLoYYMz9.js";import{E as U}from"./vendor-Cffik5UH.js";import{F as D}from"./pixi-core-filters-BDggq3H4.js";import{c as k}from"./pixi-graphics-q8yFmetg.js";function M(e){const t={};for(const r in e)void 0!==e[r]&&(t[r]=e[r]);return t}const I=new e;class E{constructor(e=1/0,t=1/0,r=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=I,this.minX=e,this.minY=t,this.maxX=r,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new t);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=I,this}set(e,t,r,i){this.minX=e,this.minY=t,this.maxX=r,this.maxY=i}addFrame(e,t,r,i,n){n||(n=this.matrix);const s=n.a,o=n.b,a=n.c,h=n.d,d=n.tx,l=n.ty;let u=this.minX,c=this.minY,p=this.maxX,f=this.maxY,m=s*e+a*t+d,x=o*e+h*t+l;m<u&&(u=m),x<c&&(c=x),m>p&&(p=m),x>f&&(f=x),m=s*r+a*t+d,x=o*r+h*t+l,m<u&&(u=m),x<c&&(c=x),m>p&&(p=m),x>f&&(f=x),m=s*e+a*i+d,x=o*e+h*i+l,m<u&&(u=m),x<c&&(c=x),m>p&&(p=m),x>f&&(f=x),m=s*r+a*i+d,x=o*r+h*i+l,m<u&&(u=m),x<c&&(c=x),m>p&&(p=m),x>f&&(f=x),this.minX=u,this.minY=c,this.maxX=p,this.maxY=f}addRect(e,t){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height,t)}addBounds(e,t){this.addFrame(e.minX,e.minY,e.maxX,e.maxY,t)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const t=this.minX,r=this.minY,i=this.maxX,n=this.maxY,{a:s,b:o,c:a,d:h,tx:d,ty:l}=e;let u=s*t+a*r+d,c=o*t+h*r+l;this.minX=u,this.minY=c,this.maxX=u,this.maxY=c,u=s*i+a*r+d,c=o*i+h*r+l,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY,u=s*t+a*n+d,c=o*t+h*n+l,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY,u=s*i+a*n+d,c=o*i+h*n+l,this.minX=u<this.minX?u:this.minX,this.minY=c<this.minY?c:this.minY,this.maxX=u>this.maxX?u:this.maxX,this.maxY=c>this.maxY?c:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}fitBounds(e,t,r,i){return this.minX<e&&(this.minX=e),this.maxX>t&&(this.maxX=t),this.minY<r&&(this.minY=r),this.maxY>i&&(this.maxY=i),this}pad(e,t=e){return this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new E(this.minX,this.minY,this.maxX,this.maxY)}scale(e,t=e){return this.minX*=e,this.minY*=t,this.maxX*=e,this.maxY*=t,this}get x(){return this.minX}set x(e){const t=this.maxX-this.minX;this.minX=e,this.maxX=e+t}get y(){return this.minY}set y(e){const t=this.maxY-this.minY;this.minY=e,this.maxY=e+t}get width(){return this.maxX-this.minX}set width(e){this.maxX=this.minX+e}get height(){return this.maxY-this.minY}set height(e){this.maxY=this.minY+e}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,t,r,i){let n=this.minX,s=this.minY,o=this.maxX,a=this.maxY;i||(i=this.matrix);const h=i.a,d=i.b,l=i.c,u=i.d,c=i.tx,p=i.ty;for(let f=t;f<r;f+=2){const t=e[f],r=e[f+1],i=h*t+l*r+c,m=d*t+u*r+p;n=i<n?i:n,s=m<s?m:s,o=i>o?i:o,a=m>a?m:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a}containsPoint(e,t){return this.minX<=e&&this.minY<=t&&this.maxX>=e&&this.maxY>=t}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this}}const F={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(e){"boolean"==typeof e&&!1===e?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(!0===e?{}:e))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(e){r("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(e)}},V={allowChildren:!0,removeChildren(e=0,t){const r=t??this.children.length,i=r-e,s=[];if(i>0&&i<=r){for(let i=r-1;i>=e;i--){const e=this.children[i];e&&(s.push(e),e.parent=null)}n(this.children,e,r);const t=this.renderGroup||this.parentRenderGroup;t&&t.removeChildren(s);for(let e=0;e<s.length;++e){const t=s[e];t.parentRenderLayer?.detach(t),this.emit("childRemoved",t,this,e),s[e].emit("removed",this)}return s.length>0&&this._didViewChangeTick++,s}if(0===i&&0===this.children.length)return s;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(e){const t=this.getChildAt(e);return this.removeChild(t)},getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]},setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(e),this.addChildAt(e,t)},getChildIndex(e){const t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(e,t){this.allowChildren||r(i,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:n}=this;if(t<0||t>n.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${n.length}`);if(e.parent){const r=e.parent.children.indexOf(e);if(e.parent===this&&r===t)return e;-1!==r&&e.parent.children.splice(r,1)}t===n.length?n.push(e):n.splice(t,0,e),e.parent=this,e.didChange=!0,e._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(e),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",e,this,t),e.emit("added",this),e},swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...e){return 1===e.length?this.reparentChildAt(e[0],this.children.length):(e.forEach(e=>this.reparentChildAt(e,this.children.length)),e[0])},reparentChildAt(e,t){if(e.parent===this)return this.setChildIndex(e,t),e;const r=e.worldTransform.clone();e.removeFromParent(),this.addChildAt(e,t);const i=this.worldTransform.clone();return i.invert(),r.prepend(i),e.setFromMatrix(r),e},replaceChild(e,t){e.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(e)),t.setFromMatrix(e.localTransform),t.updateLocalTransform(),this.removeChild(e)}},O={collectRenderables(e,t,r){this.parentRenderLayer&&this.parentRenderLayer!==r||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(e,t,r):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,e):this.collectRenderablesWithEffects(e,t,r))},collectRenderablesSimple(e,t,r){const i=this.children,n=i.length;for(let s=0;s<n;s++)i[s].collectRenderables(e,t,r)},collectRenderablesWithEffects(e,t,r){const{renderPipes:i}=t;for(let n=0;n<this.effects.length;n++){const t=this.effects[n];i[t.pipe].push(t,this,e)}this.collectRenderablesSimple(e,t,r);for(let n=this.effects.length-1;n>=0;n--){const t=this.effects[n];i[t.pipe].pop(t,this,e)}}},L={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const e=this.renderGroup||this.parentRenderGroup;e&&(e.structureDidChange=!0)},addEffect(e){-1===this.effects.indexOf(e)&&(this.effects.push(e),this.effects.sort((e,t)=>e.priority-t.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(e){const t=this.effects.indexOf(e);-1!==t&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(e){const t=this._maskEffect;t?.mask!==e&&(t&&(this.removeEffect(t),s.returnMaskEffect(t),this._maskEffect=null),null!=e&&(this._maskEffect=s.getMaskEffect(e),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(e){this._maskOptions={...this._maskOptions,...e},e.mask&&(this.mask=e.mask),this._markStructureAsChanged()},set filters(e){!Array.isArray(e)&&e&&(e=[e]);const t=this._filterEffect||(this._filterEffect=new D),r=e?.length>0,i=r!==t.filters?.length>0;e=Array.isArray(e)?e.slice(0):e,t.filters=Object.freeze(e),i&&(r?this.addEffect(t):(this.removeEffect(t),t.filters=e??null))},get filters(){return this._filterEffect?.filters},set filterArea(e){this._filterEffect||(this._filterEffect=new D),this._filterEffect.filterArea=e},get filterArea(){return this._filterEffect?.filterArea}},z={label:null,get name(){return r(i,"Container.name property has been removed, use Container.label instead"),this.label},set name(e){r(i,"Container.name property has been removed, use Container.label instead"),this.label=e},getChildByName(e,t=!1){return this.getChildByLabel(e,t)},getChildByLabel(e,t=!1){const r=this.children;for(let i=0;i<r.length;i++){const t=r[i];if(t.label===e||e instanceof RegExp&&e.test(t.label))return t}if(t)for(let i=0;i<r.length;i++){const t=r[i].getChildByLabel(e,!0);if(t)return t}return null},getChildrenByLabel(e,t=!1,r=[]){const i=this.children;for(let n=0;n<i.length;n++){const t=i[n];(t.label===e||e instanceof RegExp&&e.test(t.label))&&r.push(t)}if(t)for(let n=0;n<i.length;n++)i[n].getChildrenByLabel(e,!0,r);return r}},N=o.getPool(e),W=o.getPool(E),$=new e,j={getFastGlobalBounds(e,t){t||(t=new E),t.clear(),this._getGlobalBoundsRecursive(!!e,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const r=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(r.worldTransform),t},_getGlobalBoundsRecursive(e,t,r){let i=t;if(e&&this.parentRenderLayer&&this.parentRenderLayer!==r)return;if(7!==this.localDisplayStatus||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(i=W.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const e=this.bounds;i.addFrame(e.minX,e.minY,e.maxX,e.maxY,this.groupTransform)}const t=this.children;for(let n=0;n<t.length;n++)t[n]._getGlobalBoundsRecursive(e,i,r)}if(n){let e=!1;const r=this.renderGroup||this.parentRenderGroup;for(let t=0;t<this.effects.length;t++)this.effects[t].addBounds&&(e||(e=!0,i.applyMatrix(r.worldTransform)),this.effects[t].addBounds(i,!0));e&&i.applyMatrix(r.worldTransform.copyTo($).invert()),t.addBounds(i),W.return(i)}else this.renderGroup&&(t.addBounds(i,this.relativeGroupTransform),W.return(i))}};function H(t,r,i){let n,s;return i.clear(),t.parent?r?n=t.parent.worldTransform:(s=N.get().identity(),n=J(t,s)):n=e.IDENTITY,q(t,i,n,r),s&&N.return(s),i.isValid||i.set(0,0,0,0),i}function q(t,r,i,n){if(!t.visible||!t.measurable)return;let s;n?s=t.worldTransform:(t.updateLocalTransform(),s=N.get(),s.appendFrom(t.localTransform,i));const o=r,a=!!t.effects.length;if(a&&(r=W.get().clear()),t.boundsArea)r.addRect(t.boundsArea,s);else{const e=t.bounds;e&&!e.isEmpty()&&(r.matrix=s,r.addBounds(e));for(let i=0;i<t.children.length;i++)q(t.children[i],r,s,n)}if(a){for(let e=0;e<t.effects.length;e++)t.effects[e].addBounds?.(r);o.addBounds(r,e.IDENTITY),W.return(r)}n||N.return(s)}function J(e,t){const r=e.parent;return r&&(J(r,t),r.updateLocalTransform(),t.append(r.localTransform)),t}function K(e,t){if(16777215===e||!t)return t;if(16777215===t||!e)return e;return(((e>>16&255)*(t>>16&255)/255|0)<<16)+(((e>>8&255)*(t>>8&255)/255|0)<<8)+((255&e)*(255&t)/255|0)}const Q=16777215;function Z(e,t){return e===Q?t:t===Q?e:K(e,t)}function ee(e){return((255&e)<<16)+(65280&e)+(e>>16&255)}const te={getGlobalAlpha(e){if(e)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,r=this.parent;for(;r;)t*=r.alpha,r=r.parent;return t},getGlobalTransform(t=new e,r){if(r)return t.copyFrom(this.worldTransform);this.updateLocalTransform();const i=J(this,N.get().identity());return t.appendFrom(this.localTransform,i),N.return(i),t},getGlobalTint(e){if(e)return this.renderGroup?ee(this.renderGroup.worldColor):this.parentRenderGroup?ee(Z(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,r=this.parent;for(;r;)t=Z(t,r.localColor),r=r.parent;return ee(t)}};function re(t,r,i){return r.clear(),i||(i=e.IDENTITY),ie(t,r,i,t,!0),r.isValid||r.set(0,0,0,0),r}function ie(t,r,i,n,s){let o;if(s)o=N.get(),o=i.copyTo(o);else{if(!t.visible||!t.measurable)return;t.updateLocalTransform();const e=t.localTransform;o=N.get(),o.appendFrom(e,i)}const a=r,h=!!t.effects.length;if(h&&(r=W.get().clear()),t.boundsArea)r.addRect(t.boundsArea,o);else{t.renderPipeId&&(r.matrix=o,r.addBounds(t.bounds));const e=t.children;for(let t=0;t<e.length;t++)ie(e[t],r,o,n,!1)}if(h){for(let e=0;e<t.effects.length;e++)t.effects[e].addLocalBounds?.(r,n);a.addBounds(r,e.IDENTITY),W.return(r)}N.return(o)}function ne(e,t){const r=e.children;for(let i=0;i<r.length;i++){const e=r[i],n=e.uid,s=(65535&e._didViewChangeTick)<<16|65535&e._didContainerChangeTick,o=t.index;t.data[o]===n&&t.data[o+1]===s||(t.data[t.index]=n,t.data[t.index+1]=s,t.didChange=!0),t.index=o+2,e.children.length&&ne(e,t)}return t.didChange}const se=new e,oe={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(e,t){const r=Math.sign(this.scale.x)||1;this.scale.x=0!==t?e/t*r:r},_setHeight(e,t){const r=Math.sign(this.scale.y)||1;this.scale.y=0!==t?e/t*r:r},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new E});const e=this._localBoundsCacheData;return e.index=1,e.didChange=!1,e.data[0]!==this._didViewChangeTick&&(e.didChange=!0,e.data[0]=this._didViewChangeTick),ne(this,e),e.didChange&&re(this,e.localBounds,se),e.localBounds},getBounds(e,t){return H(this,e,t||new E)}},ae={_onRender:null,set onRender(e){const t=this.renderGroup||this.parentRenderGroup;if(!e)return this._onRender&&t?.removeOnRender(this),void(this._onRender=null);this._onRender||t?.addOnRender(this),this._onRender=e},get onRender(){return this._onRender}},he={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(de))}};function de(e,t){return e._zIndex-t._zIndex}const le={getGlobalPosition(e=new a,t=!1){return this.parent?this.parent.toGlobal(this._position,e,t):(e.x=this._position.x,e.y=this._position.y),e},toGlobal(e,t,r=!1){const i=this.getGlobalTransform(N.get(),r);return t=i.apply(e,t),N.return(i),t},toLocal(e,t,r,i){t&&(e=t.toGlobal(e,r,i));const n=this.getGlobalTransform(N.get(),i);return r=n.applyInverse(e,r),N.return(n),r}};class ue{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new e,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new C,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(e){this.root=e,e._onRender&&this.addOnRender(e),e.didChange=!0;const t=e.children;for(let r=0;r<t.length;r++){const e=t[r];e._updateFlags=15,this.addChild(e)}}enableCacheAsTexture(e={}){this.textureOptions=e,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(b.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const e=this._parentCacheAsTextureRenderGroup;e&&!e.textureNeedsUpdate&&e.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const e in this.childrenToUpdate){const t=this.childrenToUpdate[e];t.list.fill(null),t.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(e){e.renderGroupParent&&e.renderGroupParent._removeRenderGroupChild(e),e.renderGroupParent=this,this.renderGroupChildren.push(e)}_removeRenderGroupChild(e){const t=this.renderGroupChildren.indexOf(e);t>-1&&this.renderGroupChildren.splice(t,1),e.renderGroupParent=null}addChild(e){if(this.structureDidChange=!0,e.parentRenderGroup=this,e.updateTick=-1,e.parent===this.root?e.relativeRenderGroupDepth=1:e.relativeRenderGroupDepth=e.parent.relativeRenderGroupDepth+1,e.didChange=!0,this.onChildUpdate(e),e.renderGroup)return void this.addRenderGroupChild(e.renderGroup);e._onRender&&this.addOnRender(e);const t=e.children;for(let r=0;r<t.length;r++)this.addChild(t[r])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&(e.renderGroup||this.removeOnRender(e)),e.parentRenderGroup=null,e.renderGroup)return void this._removeRenderGroupChild(e.renderGroup);const t=e.children;for(let r=0;r<t.length;r++)this.removeChild(t[r])}removeChildren(e){for(let t=0;t<e.length;t++)this.removeChild(e[t])}onChildUpdate(e){let t=this.childrenToUpdate[e.relativeRenderGroupDepth];t||(t=this.childrenToUpdate[e.relativeRenderGroupDepth]={index:0,list:[]}),t.list[t.index++]=e}updateRenderable(e){e.globalDisplayStatus<7||(this.instructionSet.renderPipes[e.renderPipeId].updateRenderable(e),e.didViewUpdate=!1)}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}get isRenderable(){return 7===this.root.localDisplayStatus&&this.worldAlpha>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(e){for(let t=0;t<this._onRenderContainers.length;t++)this._onRenderContainers[t]._onRender(e)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(e=[]){const t=this.root.children;for(let r=0;r<t.length;r++)this._getChildren(t[r],e);return e}_getChildren(e,t=[]){if(t.push(e),e.renderGroup)return t;const r=e.children;for(let i=0;i<r.length;i++)this._getChildren(r[i],t);return t}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return 1&this._matrixDirty?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new e),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return 2&this._matrixDirty?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new e),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(4&this._matrixDirty))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new e),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}const ce=new d(null),pe=new d(null),fe=new d(null,1,1),me=new d(null);class xe extends U{constructor(t={}){super(),this.uid=h("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new e,this.relativeGroupTransform=new e,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new d(this,0,0),this._scale=fe,this._pivot=pe,this._origin=me,this._skew=ce,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],function(e,t,r={}){for(const i in t)r[i]||void 0===t[i]||(e[i]=t[i])}(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(e){r("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),l.mixin(xe,e)}set _didChangeId(e){this._didViewChangeTick=e>>12&4095,this._didContainerChangeTick=4095&e}get _didChangeId(){return 4095&this._didContainerChangeTick|(4095&this._didViewChangeTick)<<12}addChild(...e){if(this.allowChildren||r(i,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let t=0;t<e.length;t++)this.addChild(e[t]);return e[0]}const t=e[0],n=this.renderGroup||this.parentRenderGroup;return t.parent===this?(this.children.splice(this.children.indexOf(t),1),this.children.push(t),n&&(n.structureDidChange=!0),t):(t.parent&&t.parent.removeChild(t),this.children.push(t),this.sortableChildren&&(this.sortDirty=!0),t.parent=this,t.didChange=!0,t._updateFlags=15,n&&n.addChild(t),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this),this._didViewChangeTick++,0!==t._zIndex&&t.depthOfChildModified(),t)}removeChild(...e){if(e.length>1){for(let t=0;t<e.length;t++)this.removeChild(e[t]);return e[0]}const t=e[0],r=this.children.indexOf(t);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(t):this.parentRenderGroup&&this.parentRenderGroup.removeChild(t),t.parentRenderLayer&&t.parentRenderLayer.detach(t),t.parent=null,this.emit("childRemoved",t,this,r),t.emit("removed",this)),t}_onUpdate(e){e&&e===this._skew&&this._updateSkew(),this._didContainerChangeTick++,this.didChange||(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(e){!!this.renderGroup!==e&&(e?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=o.get(ue,this),this.groupTransform=e.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const e=this.parentRenderGroup;e?.removeChild(this),o.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,e?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&0===this.effects.length}get worldTransform(){return this._worldTransform||(this._worldTransform=new e),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this._skew))}get angle(){return this.rotation*u}set angle(e){this.rotation=e*c}get pivot(){return this._pivot===pe&&(this._pivot=new d(this,0,0)),this._pivot}set pivot(e){this._pivot===pe&&(this._pivot=new d(this,0,0),this._origin!==me&&p("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),"number"==typeof e?this._pivot.set(e):this._pivot.copyFrom(e)}get skew(){return this._skew===ce&&(this._skew=new d(this,0,0)),this._skew}set skew(e){this._skew===ce&&(this._skew=new d(this,0,0)),this._skew.copyFrom(e)}get scale(){return this._scale===fe&&(this._scale=new d(this,1,1)),this._scale}set scale(e){this._scale===fe&&(this._scale=new d(this,0,0)),"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e?this._scale.set(e):this._scale.copyFrom(e)}get origin(){return this._origin===me&&(this._origin=new d(this,0,0)),this._origin}set origin(e){this._origin===me&&(this._origin=new d(this,0,0),this._pivot!==pe&&p("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),"number"==typeof e?this._origin.set(e):this._origin.copyFrom(e)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(e){const t=this.getLocalBounds().width;this._setWidth(e,t)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(e){const t=this.getLocalBounds().height;this._setHeight(e,t)}getSize(e){e||(e={});const t=this.getLocalBounds();return e.width=Math.abs(this.scale.x*t.width),e.height=Math.abs(this.scale.y*t.height),e}setSize(e,t){const r=this.getLocalBounds();"object"==typeof e?(t=e.height??e.width,e=e.width):t??(t=e),void 0!==e&&this._setWidth(e,r.width),void 0!==t&&this._setHeight(t,r.height)}_updateSkew(){const e=this._rotation,t=this._skew;this._cx=Math.cos(e+t._y),this._sx=Math.sin(e+t._y),this._cy=-Math.sin(e-t._x),this._sy=Math.cos(e-t._x)}updateTransform(e){return this.position.set("number"==typeof e.x?e.x:this.position.x,"number"==typeof e.y?e.y:this.position.y),this.scale.set("number"==typeof e.scaleX?e.scaleX||1:this.scale.x,"number"==typeof e.scaleY?e.scaleY||1:this.scale.y),this.rotation="number"==typeof e.rotation?e.rotation:this.rotation,this.skew.set("number"==typeof e.skewX?e.skewX:this.skew.x,"number"==typeof e.skewY?e.skewY:this.skew.y),this.pivot.set("number"==typeof e.pivotX?e.pivotX:this.pivot.x,"number"==typeof e.pivotY?e.pivotY:this.pivot.y),this.origin.set("number"==typeof e.originX?e.originX:this.origin.x,"number"==typeof e.originY?e.originY:this.origin.y),this}setFromMatrix(e){e.decompose(this)}updateLocalTransform(){const e=this._didContainerChangeTick;if(this._didLocalTransformChangeId===e)return;this._didLocalTransformChangeId=e;const t=this.localTransform,r=this._scale,i=this._pivot,n=this._origin,s=this._position,o=r._x,a=r._y,h=i._x,d=i._y,l=-n._x,u=-n._y;t.a=this._cx*o,t.b=this._sx*o,t.c=this._cy*a,t.d=this._sy*a,t.tx=s._x-(h*t.a+d*t.c)+(l*t.a+u*t.c)-l,t.ty=s._y-(h*t.b+d*t.d)+(l*t.b+u*t.d)-u}set alpha(e){e!==this.localAlpha&&(this.localAlpha=e,this._updateFlags|=1,this._onUpdate())}get alpha(){return this.localAlpha}set tint(e){const t=f.shared.setValue(e??16777215).toBgrNumber();t!==this.localColor&&(this.localColor=t,this._updateFlags|=1,this._onUpdate())}get tint(){return ee(this.localColor)}set blendMode(e){this.localBlendMode!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=2,this.localBlendMode=e,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(2&this.localDisplayStatus)}set visible(e){const t=e?2:0;(2&this.localDisplayStatus)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(4&this.localDisplayStatus)}set culled(e){const t=e?0:4;(4&this.localDisplayStatus)!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=4,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(1&this.localDisplayStatus)}set renderable(e){const t=e?1:0;(1&this.localDisplayStatus)!==t&&(this._updateFlags|=4,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return 7===this.localDisplayStatus&&this.groupAlpha>0}destroy(e=!1){if(this.destroyed)return;let t;this.destroyed=!0,this.children.length&&(t=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners();if(("boolean"==typeof e?e:e?.children)&&t)for(let r=0;r<t.length;++r)t[r].destroy(e);this.renderGroup?.destroy(),this.renderGroup=null}}l.mixin(xe,V,j,le,ae,oe,L,z,he,m,F,te,O);const ge=new e;function _e(e,t){t.clear();const r=t.matrix;for(let i=0;i<e.length;i++){const r=e[i];if(r.globalDisplayStatus<7)continue;const n=r.renderGroup??r.parentRenderGroup;t.matrix=n?.isCachedAsTexture?ge.copyFrom(n.textureOffsetInverseTransform).append(r.worldTransform):n?._parentCacheAsTextureRenderGroup?ge.copyFrom(n._parentCacheAsTextureRenderGroup.inverseWorldTransform).append(r.groupTransform):r.worldTransform,t.addBounds(r.bounds)}return t.matrix=r,t}class Ce{constructor(e){this._renderer=e}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(e,t){this._renderer.renderPipes.batch.break(t),t.add(e)}execute(e){e.isRenderable&&e.render(this._renderer)}destroy(){this._renderer=null}}function be(e,t){const r=e.instructionSet,i=r.instructions;for(let n=0;n<r.instructionSize;n++){const e=i[n];t[e.renderPipeId].execute(e)}}Ce.extension={type:[x.WebGLPipes,x.WebGPUPipes,x.CanvasPipes],name:"customRender"};const ye=new e;class Te{constructor(e){this._renderer=e}addRenderGroup(e,t){e.isCachedAsTexture?this._addRenderableCacheAsTexture(e,t):this._addRenderableDirect(e,t)}execute(e){e.isRenderable&&(e.isCachedAsTexture?this._executeCacheAsTexture(e):this._executeDirect(e))}destroy(){this._renderer=null}_addRenderableDirect(e,t){this._renderer.renderPipes.batch.break(t),e._batchableRenderGroup&&(o.return(e._batchableRenderGroup),e._batchableRenderGroup=null),t.add(e)}_addRenderableCacheAsTexture(e,t){const r=e._batchableRenderGroup??(e._batchableRenderGroup=o.get(_));r.renderable=e.root,r.transform=e.root.relativeGroupTransform,r.texture=e.texture,r.bounds=e._textureBounds,t.add(e),this._renderer.renderPipes.blendMode.pushBlendMode(e,e.root.groupBlendMode,t),this._renderer.renderPipes.batch.addToBatch(r,t),this._renderer.renderPipes.blendMode.popBlendMode(t)}_executeCacheAsTexture(e){if(e.textureNeedsUpdate){e.textureNeedsUpdate=!1;const t=ye.identity().translate(-e._textureBounds.x,-e._textureBounds.y);this._renderer.renderTarget.push(e.texture,!0,null,e.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:t,worldColor:4294967295,offset:{x:0,y:0}}),be(e,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}e._batchableRenderGroup._batcher.updateElement(e._batchableRenderGroup),e._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(e){this._renderer.globalUniforms.push({worldTransformMatrix:e.inverseParentTextureTransform,worldColor:e.worldColorAlpha}),be(e,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}function ve(e,t){t||(t=0);for(let r=t;r<e.length&&e[r];r++)e[r]=null}Te.extension={type:[x.WebGLPipes,x.WebGPUPipes,x.CanvasPipes],name:"renderGroup"};const Re=new xe;function Ge(e,t=!1){!function(e){const t=e.root;let r;if(e.renderGroupParent){const i=e.renderGroupParent;e.worldTransform.appendFrom(t.relativeGroupTransform,i.worldTransform),e.worldColor=Z(t.groupColor,i.worldColor),r=t.groupAlpha*i.worldAlpha}else e.worldTransform.copyFrom(t.localTransform),e.worldColor=t.localColor,r=t.localAlpha;r=r<0?0:r>1?1:r,e.worldAlpha=r,e.worldColorAlpha=e.worldColor+(255*r<<24)}(e);const r=e.childrenToUpdate,i=e.updateTick++;for(const n in r){const t=Number(n),s=r[n],o=s.list,a=s.index;for(let r=0;r<a;r++){const n=o[r];n.parentRenderGroup===e&&n.relativeRenderGroupDepth===t&&we(n,i,0)}ve(o,a),s.index=0}if(t)for(let n=0;n<e.renderGroupChildren.length;n++)Ge(e.renderGroupChildren[n],t)}function we(e,t,r){if(t===e.updateTick)return;e.updateTick=t,e.didChange=!1;const i=e.localTransform;e.updateLocalTransform();const n=e.parent;if(n&&!n.renderGroup?(r|=e._updateFlags,e.relativeGroupTransform.appendFrom(i,n.relativeGroupTransform),7&r&&Ye(e,n,r)):(r=e._updateFlags,e.relativeGroupTransform.copyFrom(i),7&r&&Ye(e,Re,r)),!e.renderGroup){const i=e.children,n=i.length;for(let e=0;e<n;e++)we(i[e],t,r);const s=e.parentRenderGroup,o=e;o.renderPipeId&&!s.structureDidChange&&s.updateRenderable(o)}}function Ye(e,t,r){if(1&r){e.groupColor=Z(e.localColor,t.groupColor);let r=e.localAlpha*t.groupAlpha;r=r<0?0:r>1?1:r,e.groupAlpha=r,e.groupColorAlpha=e.groupColor+(255*r<<24)}2&r&&(e.groupBlendMode="inherit"===e.localBlendMode?t.groupBlendMode:e.localBlendMode),4&r&&(e.globalDisplayStatus=e.localDisplayStatus&t.globalDisplayStatus),e._updateFlags=0}const Be=new e;class Ae{constructor(e){this._renderer=e}render({container:e,transform:t}){const r=e.parent,i=e.renderGroup.renderGroupParent;e.parent=null,e.renderGroup.renderGroupParent=null;const n=this._renderer,s=Be;t&&(s.copyFrom(e.renderGroup.localTransform),e.renderGroup.localTransform.copyFrom(t));const o=n.renderPipes;this._updateCachedRenderGroups(e.renderGroup,null),this._updateRenderGroups(e.renderGroup),n.globalUniforms.start({worldTransformMatrix:t?e.renderGroup.localTransform:e.renderGroup.worldTransform,worldColor:e.renderGroup.worldColorAlpha}),be(e.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),t&&e.renderGroup.localTransform.copyFrom(s),e.parent=r,e.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(e,t){if(e._parentCacheAsTextureRenderGroup=t,e.isCachedAsTexture){if(!e.textureNeedsUpdate)return;t=e}for(let r=e.renderGroupChildren.length-1;r>=0;r--)this._updateCachedRenderGroups(e.renderGroupChildren[r],t);if(e.invalidateMatrices(),e.isCachedAsTexture){if(e.textureNeedsUpdate){const t=e.root.getLocalBounds();t.ceil();const r=e.texture;e.texture&&b.returnTexture(e.texture,!0);const i=this._renderer,n=e.textureOptions.resolution||i.view.resolution,s=e.textureOptions.antialias??i.view.antialias,o=e.textureOptions.scaleMode??"linear",a=b.getOptimalTexture(t.width,t.height,n,s);a._source.style=new y({scaleMode:o}),e.texture=a,e._textureBounds||(e._textureBounds=new E),e._textureBounds.copyFrom(t),r!==e.texture&&e.renderGroupParent&&(e.renderGroupParent.structureDidChange=!0)}}else e.texture&&(b.returnTexture(e.texture,!0),e.texture=null)}_updateRenderGroups(e){const t=this._renderer,r=t.renderPipes;if(e.runOnRender(t),e.instructionSet.renderPipes=r,e.structureDidChange?ve(e.childrenRenderablesToUpdate.list,0):function(e,t){const{list:r}=e.childrenRenderablesToUpdate;let i=!1;for(let n=0;n<e.childrenRenderablesToUpdate.index;n++){const e=r[n];if(i=t[e.renderPipeId].validateRenderable(e),i)break}e.structureDidChange=i}(e,r),Ge(e),e.structureDidChange?(e.structureDidChange=!1,this._buildInstructions(e,t)):this._updateRenderables(e),e.childrenRenderablesToUpdate.index=0,t.renderPipes.batch.upload(e.instructionSet),!e.isCachedAsTexture||e.textureNeedsUpdate)for(let i=0;i<e.renderGroupChildren.length;i++)this._updateRenderGroups(e.renderGroupChildren[i])}_updateRenderables(e){const{list:t,index:r}=e.childrenRenderablesToUpdate;for(let i=0;i<r;i++){const r=t[i];r.didViewUpdate&&e.updateRenderable(r)}ve(t,r)}_buildInstructions(e,t){const r=e.root,i=e.instructionSet;i.reset();const n=t.renderPipes?t:t.batch.renderer,s=n.renderPipes;s.batch.buildStart(i),s.blendMode.buildStart(),s.colorMask.buildStart(),r.sortableChildren&&r.sortChildren(),r.collectRenderablesWithEffects(i,n,null),s.batch.buildEnd(i),s.blendMode.buildEnd(i)}}Ae.extension={type:[x.WebGLSystem,x.WebGPUSystem,x.CanvasSystem],name:"renderGroup"};class Xe{execute(e,t){const r=e.state,i=e.renderer,n=t.shader||e.defaultShader;n.resources.uTexture=t.texture._source,n.resources.uniforms=e.localUniforms;const s=i.gl,o=e.getBuffers(t);i.shader.bind(n),i.state.set(r),i.geometry.bind(o.geometry,n.glProgram);const a=2===o.geometry.indexBuffer.data.BYTES_PER_ELEMENT?s.UNSIGNED_SHORT:s.UNSIGNED_INT;s.drawElements(s.TRIANGLES,6*t.particleChildren.length,a,0)}}class Pe{execute(e,t){const r=e.renderer,i=t.shader||e.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(e.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(t.texture);const n=e.state,s=e.getBuffers(t);r.encoder.draw({geometry:s.geometry,shader:t.shader||e.defaultShader,state:n,size:6*t.particleChildren.length})}}function Se(e,t=null){const r=6*e;if(r>65535?t||(t=new Uint32Array(r)):t||(t=new Uint16Array(r)),t.length!==r)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let i=0,n=0;i<r;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function Ue(e,t){const r=[];r.push("\n\n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const s in e){const n=e[s];if(t!==n.dynamic)continue;r.push(`offset = index + ${i}`),r.push(n.code);i+=T(n.format).stride/4}r.push("\n            index += stride * 4;\n        }\n    "),r.unshift(`\n        var stride = ${i};\n    `);const n=r.join("\n");return new Function("ps","f32v","u32v",n)}class De{constructor(e){this._size=0,this._generateParticleUpdateCache={};const t=this._size=e.size??1e3,r=e.properties;let i=0,n=0;for(const d in r){const e=r[d],t=T(e.format);e.dynamic?n+=t.stride:i+=t.stride}this._dynamicStride=n/4,this._staticStride=i/4,this.staticAttributeBuffer=new g(4*t*i),this.dynamicAttributeBuffer=new g(4*t*n),this.indexBuffer=Se(t);const s=new v;let o=0,a=0;this._staticBuffer=new R({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:G.VERTEX|G.COPY_DST}),this._dynamicBuffer=new R({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:G.VERTEX|G.COPY_DST});for(const d in r){const e=r[d],t=T(e.format);e.dynamic?(s.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*o,format:e.format}),o+=t.size):(s.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*a,format:e.format}),a+=t.size)}s.addIndex(this.indexBuffer);const h=this.getParticleUpdate(r);this._dynamicUpload=h.dynamicUpdate,this._staticUpload=h.staticUpdate,this.geometry=s}getParticleUpdate(e){const t=function(e){const t=[];for(const r in e){const i=e[r];t.push(r,i.code,i.dynamic?"d":"s")}return t.join("_")}(e);return this._generateParticleUpdateCache[t]||(this._generateParticleUpdateCache[t]=this.generateParticleUpdate(e)),this._generateParticleUpdateCache[t]}generateParticleUpdate(e){return function(e){return{dynamicUpdate:Ue(e,!0),staticUpdate:Ue(e,!1)}}(e)}update(e,t){e.length>this._size&&(t=!0,this._size=Math.max(e.length,1.5*this._size|0),this.staticAttributeBuffer=new g(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new g(this._size*this._dynamicStride*4*4),this.indexBuffer=Se(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(e,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,e.length*this._dynamicStride*4,!0),t){const t=this.staticAttributeBuffer;this._staticUpload(e,t.float32View,t.uint32View),this._staticBuffer.setDataWithSize(t.float32View,e.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var ke="\nstruct ParticleUniforms {\n  uTranslationMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uRound:f32,\n  uResolution:vec2<f32>,\n};\n\nfn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n{\n  return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   var position = vec4((uniforms.uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n   if(uniforms.uRound == 1.0) {\n       position = vec4(roundPixels(position.xy, uniforms.uResolution), position.zw);\n   }\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class Me extends w{constructor(){super({glProgram:Y.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:B.from({fragment:{source:ke,entryPoint:"mainFragment"},vertex:{source:ke,entryPoint:"mainVertex"}}),resources:{uTexture:A.WHITE.source,uSampler:new y({}),uniforms:{uTranslationMatrix:{value:new e,type:"mat3x3<f32>"},uColor:{value:new f(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class Ie{constructor(t,r){this.state=X.for2d(),this.localUniforms=new P({uTranslationMatrix:{value:new e,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=r,this.defaultShader=new Me,this.state=X.for2d()}validateRenderable(e){return!1}addRenderable(e,t){this.renderer.renderPipes.batch.break(t),t.add(e)}getBuffers(e){return e._gpuData[this.renderer.uid]||this._initBuffer(e)}_initBuffer(e){return e._gpuData[this.renderer.uid]=new De({size:e.particleChildren.length,properties:e._properties}),e._gpuData[this.renderer.uid]}updateRenderable(e){}execute(e){const t=e.particleChildren;if(0===t.length)return;const r=this.renderer,i=this.getBuffers(e);e.texture||(e.texture=t[0].texture);const n=this.state;i.update(t,e._childrenDirty),e._childrenDirty=!1,n.blendMode=S(e.blendMode,e.texture._source);const s=this.localUniforms.uniforms,o=s.uTranslationMatrix;e.worldTransform.copyTo(o),o.prepend(r.globalUniforms.globalUniformData.projectionMatrix),s.uResolution=r.globalUniforms.globalUniformData.resolution,s.uRound=r._roundPixels|e._roundPixels,k(e.groupColorAlpha,s.uColor,0),this.adaptor.execute(this,e)}destroy(){this.renderer=null,this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class Ee extends Ie{constructor(e){super(e,new Xe)}}Ee.extension={type:[x.WebGLPipes],name:"particle"};class Fe extends Ie{constructor(e){super(e,new Pe)}}Fe.extension={type:[x.WebGPUPipes],name:"particle"},l.add(Ee),l.add(Fe);export{E as B,xe as C,ue as R,re as a,W as b,_e as c,M as d,K as e,Ae as f,H as g,Te as h,Ce as i,N as m};
//# sourceMappingURL=pixi-container--XA1H1gw.js.map
